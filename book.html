<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch Scanning: The Interactive Book</title>
    <!-- Don't import main.css - it has overflow:hidden that breaks scrolling -->
    <!-- <link rel="stylesheet" href="./src/style.css"> -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --paper: #fffdf9;
            --ink: #2f2f2f;
            --ink-soft: #4b4b4b;
            --accent: #2f7dbb;
            --accent-2: #f39c12;
            --accent-3: #27ae60;
            --line: #d6d6d6;
            --shadow: rgba(47, 125, 187, 0.08);
            --card: #ffffff;
        }

        /* Override everything - ensure scrolling works! */
        html, body {
            overflow-x: hidden !important;
            overflow-y: auto !important;
            height: auto !important;
            min-height: 100% !important;
            max-height: none !important;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Atkinson Hyperlegible', sans-serif;
            line-height: 1.75;
            max-width: 980px;
            margin: 0 auto;
            padding: 36px 18px 120px 18px;
            background: var(--paper);
            color: var(--ink);
            display: block;
            position: relative;
        }

        h1, h2, h3 {
            font-weight: normal;
            margin-top: 40px;
            font-family: 'Patrick Hand', cursive;
        }

        h1 {
            font-size: 2.6rem;
            color: #1f2a33;
            border-bottom: 3px solid var(--accent);
            padding-bottom: 12px;
            letter-spacing: 0.5px;
        }

        h2 {
            font-size: 2.05rem;
            color: #2b3a46;
        }

        section {
            margin-bottom: 70px;
            padding: 28px;
            border: 2px dashed var(--line);
            border-radius: 18px;
            background: var(--card);
            box-shadow: 6px 6px 0px var(--shadow);
            page-break-inside: avoid;
        }

        .scanner-container {
            min-height: 250px;
            max-height: 60vh;
            margin: 20px 0;
            border: 2px solid var(--accent);
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .scanner-container.small {
            min-height: 180px;
            max-height: 40vh;
        }

        .scanner-container.large {
            min-height: 300px;
            max-height: 70vh;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            body {
                padding: 18px 14px 90px 14px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.6rem;
            }

            section {
                padding: 18px 16px;
                margin-bottom: 50px;
            }

            .scanner-container {
                height: 300px;
                max-height: 50vh;
            }

            .scanner-container.small {
                height: 180px;
            }

            .scanner-container.large {
                height: 350px;
                max-height: 60vh;
            }

            .chapter-nav button {
                padding: 10px 16px;
                font-size: 0.95rem;
            }

            /* Stack the comparison grids on mobile */
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }

        .demo-box {
            background: #eef5fb;
            border: 2px solid var(--accent);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .demo-title {
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 10px;
        }

        .demo-instructions {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 10px 0;
            font-size: 0.95em;
        }

        .key-badge {
            display: inline-block;
            background: #34495e;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-family: monospace;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background: var(--accent);
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background: #f2f2f2;
        }

        .highlight-box {
            background: #d5f4e6;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-box {
            background: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 15px;
            margin: 15px 0;
        }

        .info-box {
            background: #e5f1ff;
            border-left: 4px solid #3c7dd9;
            padding: 15px;
            margin: 15px 0;
            color: var(--ink);
        }

        #feedback {
            position: fixed;
            bottom: 20px;
            right: 20px;
            left: 20px;
            max-width: calc(100% - 40px);
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            text-align: center;
        }

        #feedback.show {
            opacity: 1;
        }

        .toc {
            background: #f2f5f8;
            padding: 20px;
            border-radius: 14px;
            margin: 24px 0;
            border: 2px dashed var(--line);
        }

        .toc summary {
            font-weight: bold;
            font-size: 1.2rem;
            color: #2b3a46;
            cursor: pointer;
            list-style: none; /* Hide default triangle */
        }

        .toc summary::-webkit-details-marker {
            display: none;
        }

        .toc summary::after {
            content: "+";
            float: right;
            font-weight: bold;
        }

        .toc[open] summary::after {
            content: "-";
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
            margin-top: 15px;
        }

        .toc li {
            margin: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding-bottom: 5px;
        }

        .toc a {
            color: #2980b9;
            text-decoration: none;
            display: block; /* Larger hit area */
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .hero {
            background: linear-gradient(135deg, #fff7e6, #eef5fb);
            border: 2px dashed var(--line);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0 30px;
            box-shadow: 6px 6px 0px var(--shadow);
        }

        .hero p {
            margin: 10px 0 0;
            color: var(--ink-soft);
        }

        .toc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
            margin-top: 12px;
        }

        .toc-part {
            background: #fff;
            border: 2px dashed var(--line);
            border-radius: 14px;
            padding: 14px;
        }

        .toc-part h4 {
            margin: 0 0 8px;
            font-family: 'Patrick Hand', cursive;
            font-size: 1.1rem;
        }

        .toc-part ul {
            padding-left: 18px;
            margin: 0;
        }

        .index-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0 0;
        }

        .index-chips a {
            display: inline-block;
            padding: 6px 12px;
            border: 1px dashed var(--line);
            border-radius: 999px;
            background: #fff;
            text-decoration: none;
            color: var(--ink);
            font-size: 0.95rem;
        }

        .figure-card {
            border: 2px dashed var(--line);
            border-radius: 16px;
            padding: 16px;
            background: #fffaf0;
            margin: 16px 0;
        }

        .figure-placeholder {
            border: 2px dashed var(--accent);
            border-radius: 14px;
            background: repeating-linear-gradient(
                -45deg,
                #fdfdfd,
                #fdfdfd 10px,
                #f1f1f1 10px,
                #f1f1f1 20px
            );
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #5f6b76;
            font-family: 'Patrick Hand', cursive;
        }

        .figure-caption {
            margin-top: 10px;
            font-size: 0.95rem;
            color: var(--ink-soft);
        }

        .glossary-link {
            color: var(--accent);
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .glossary-term {
            border: 2px dashed var(--line);
            border-radius: 12px;
            padding: 12px;
            margin: 10px 0;
            background: #fff;
        }

        .reaction-test {
            border: 2px dashed var(--line);
            border-radius: 16px;
            padding: 16px;
            background: #f9fbff;
            margin: 16px 0;
        }

        .reaction-display {
            height: 120px;
            border: 2px dashed var(--accent);
            border-radius: 14px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: 12px;
            font-family: 'Patrick Hand', cursive;
        }

        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .button-row button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Patrick Hand', cursive;
            font-size: 1rem;
        }

        .button-row button.secondary {
            background: #6c7a89;
        }

        .diagram {
            background: white;
            border: 2px dashed var(--line);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
            overflow-x: auto; /* Allow horizontal scroll */
        }

        details.diagram-collapsible {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        details.diagram-collapsible summary {
            padding: 15px;
            background: #f8f9fa;
            cursor: pointer;
            font-weight: bold;
            color: #2980b9;
            user-select: none;
        }

        details.diagram-collapsible summary:hover {
            background: #f0f0f0;
        }

        details.diagram-collapsible .content {
            padding: 20px;
            overflow-x: auto;
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        code {
            background: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        pre code {
            background: transparent;
            padding: 0;
        }

        .chapter-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .chapter-nav button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-family: 'Patrick Hand', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chapter-nav button:hover {
            background: #23679a;
        }

        .chapter-nav button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .chapter-nav .prev-btn {
            margin-right: auto;
        }

        .chapter-nav .next-btn {
            margin-left: auto;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
            z-index: 1000;
        }

        .back-to-top {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: #2b3a46;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 999;
        }

        @media (max-width: 768px) {
            .back-to-top {
                bottom: 70px;
                left: 15px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }

        .back-to-top:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .back-to-top.show {
            display: flex;
        }

        /* Ensure web component doesn't cause overflow */
        switch-scanner {
            display: block;
            width: 100%;
            height: 100%;
        }

        switch-scanner::part(wrapper) {
            height: 100%;
            overflow: hidden;
        }

    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    <button class="back-to-top" id="backToTop" title="Back to top">â†‘</button>

    <div class="hero">
        <h1>ğŸ¯ Switch Scanning: The Interactive Book</h1>
        <p><strong>An interactive exploration of switch access technology for developers, UX designers, clinicians, and occupational therapists.</strong></p>
        <div class="index-chips">
            <a href="#chapter-1">Foundations</a>
            <a href="#chapter-5">Basic Scanning</a>
            <a href="#chapter-7">Grouping & Efficiency</a>
            <a href="#chapter-12">Patterns & Modes</a>
            <a href="#chapter-19">User-Centered Design</a>
            <a href="#chapter-22">For Developers</a>
            <a href="#appendix-glossary">Glossary</a>
        </div>
    </div>

    <details class="toc" open>
        <summary>Table of Contents</summary>
        <div class="toc-grid">
            <div class="toc-part">
                <h4>Part I: Foundations</h4>
                <ul>
                    <li><a href="#chapter-1">1. What is a Switch?</a></li>
                    <li><a href="#chapter-2">2. The Bandwidth Problem</a></li>
                    <li><a href="#chapter-3">3. Cause & Effect</a></li>
                    <li><a href="#chapter-4">4. Selection Sets</a></li>
                </ul>
            </div>
            <div class="toc-part">
                <h4>Part II: Basic Scanning</h4>
                <ul>
                    <li><a href="#chapter-5">5. Single Switch Scanning</a></li>
                    <li><a href="#chapter-6">6. Two Switch Scanning</a></li>
                    <li><a href="#chapter-13">13. Timing & Optimization (.65 Rule)</a></li>
                </ul>
            </div>
            <div class="toc-part">
                <h4>Part III: Grouping & Efficiency</h4>
                <ul>
                    <li><a href="#chapter-7">7. Why Group?</a></li>
                    <li><a href="#chapter-8">8. Row-Column Scanning</a></li>
                    <li><a href="#chapter-9">9. Progressive Segmenting & Elimination</a></li>
                    <li><a href="#chapter-10">10. Pattern Comparison</a></li>
                    <li><a href="#chapter-11">11. Efficiency Calculator</a></li>
                </ul>
            </div>
            <div class="toc-part">
                <h4>Part IV: Patterns & Modes</h4>
                <ul>
                    <li><a href="#chapter-12">12. Patterns & Modes Hub</a></li>
                    <li><a href="#chapter-15">15. Block vs Point Technique</a></li>
                    <li><a href="#chapter-16">16. Continuous Scanning</a></li>
                    <li><a href="#chapter-17">17. Critical Overscan</a></li>
                    <li><a href="#chapter-18">18. Directed Scanning</a></li>
                </ul>
            </div>
            <div class="toc-part">
                <h4>Part V: User-Centered Design</h4>
                <ul>
                    <li><a href="#chapter-19">19. Error Recovery</a></li>
                    <li><a href="#chapter-20">20. Feedback & Highlighting</a></li>
                    <li><a href="#chapter-21">21. User Profiles</a></li>
                </ul>
            </div>
            <div class="toc-part">
                <h4>Part VI: For Developers</h4>
                <ul>
                    <li><a href="#chapter-22">22. Implementing Scanners</a></li>
                    <li><a href="#chapter-23">23. Accessibility Testing</a></li>
                    <li><a href="#chapter-24">24. Design Patterns</a></li>
                </ul>
            </div>
            <div class="toc-part">
                <h4>Appendices</h4>
                <ul>
                    <li><a href="#appendix-glossary">Appendix B: Glossary</a></li>
                </ul>
            </div>
        </div>
    </details>

    <!-- Chapter 1 -->
    <section id="chapter-1">
        <h2>Chapter 1: What is a Switch?</h2>

        <p>A <strong><a class="glossary-link" href="#glossary-term-switch">switch</a></strong> is an assistive technology device that provides a simple binary input: <strong>ON</strong> or <strong>OFF</strong>. Unlike a keyboard with many keys or a mouse with X/Y coordinates, a switch is the simplest possible input mechanism.</p>

        <h3>Physical Switch Types</h3>

        <ul>
            <li><strong>Button Switches</strong> - Large or small buttons activated with any body part</li>
            <li><strong>Joystick Switches</strong> - Directional switches activated by tilting</li>
            <li><strong>Pressure Pads</strong> - Activated by leaning or pressing</li>
            <li><strong>Puff/Sip Switches</strong> - Controlled by breath through a tube</li>
            <li><strong>Muscle Sensors</strong> - Detect muscle contraction (e.g., eyebrow raise)</li>
            <li><strong>Beam Switches</strong> - Broken by hand movement through infrared beam</li>
        </ul>

        <div class="highlight-box">
            <strong>ğŸ’¡ Key Insight:</strong> For people with severe physical disabilities, a switch may be the ONLY reliable voluntary movement they can perform. Scanning transforms this single binary input into full access to technology.
        </div>
    </section>

    <!-- Chapter 2 -->
    <section id="chapter-2">
        <h2>Chapter 2: The Bandwidth Problem</h2>

        <p><strong>Input Bandwidth</strong> refers to the amount of information a user can transmit per unit of time.</p>

        <table class="comparison-table">
            <tr>
                <th>Input Type</th>
                <th>Bandwidth</th>
                <th>Speed</th>
            </tr>
            <tr>
                <td>Touch Typist</td>
                <td>High (10+ fingers)</td>
                <td>~100 words/minute</td>
            </tr>
            <tr>
                <td>Hunt & Peck</td>
                <td>Medium (1-2 fingers)</td>
                <td>~20 words/minute</td>
            </tr>
            <tr>
                <td>Switch User</td>
                <td>Low (1 binary input)</td>
                <td>~5-15 words/minute</td>
            </tr>
        </table>

        <h3>The Sushi Bar Analogy</h3>

        <p>Imagine a sushi bar where dishes rotate past you on a conveyor belt. You cannot reach everything at onceâ€”you must wait for the dish you want to come to you, then grab it quickly.</p>

        <div class="info-box">
            <strong>Switch users trade TIME for ACCESS.</strong><br>
            They don't have instant access to any item like a mouse user. They must wait for the scan to reach the item they want, then activate their switch at precisely the right moment.
        </div>

        <div class="diagram">
            <pre style="background: white; color: #333;">
High Bandwidth     â”‚  Low Bandwidth
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Touch Typist       â”‚  Switch User
(10+ fingers)      â”‚  (1 bit: ON/OFF)
     â”‚                    â”‚
     â–¼                    â–¼
Full Keyboard       â”‚  Scanning Interface
100+ keys           â”‚  (Access via timing)
     â”‚                    â”‚
     â–¼                    â–¼
Fast Typing         â”‚  Full Access
~100 wpm            â”‚  ~5-15 wpm
            </pre>
        </div>
    </section>

    <!-- Chapter 3 -->
    <section id="chapter-3">
        <h2>Chapter 3: Cause & Effect</h2>

        <p>Before scanning, users must understand <strong>Cause and Effect</strong>: "When I activate my switch, something happens."</p>

        <p>This is the foundation of all switch use. Without understanding this connection, scanning makes no sense.</p>

        <h3>Interactive Demo 1: Simple Cause & Effect</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Press <span class="key-badge">Space</span> or click "Select" to play music!
        </div>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-mode="cause-effect"
                grid-cols="1"
                custom-items='[{"label":"ğŸµ Play Music!", "image":"https://api.iconify.design/twemoji:musical-note.svg", "id":"play"}]'>
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>What's happening:</strong>
            <ul>
                <li>Only 1 item available</li>
                <li>Switch press ALWAYS triggers it</li>
                <li>User learns: My press â†’ Effect happens</li>
                <li>Builds confidence and understanding</li>
            </ul>
        </div>

        <h3>The Learning Progression</h3>

        <ol>
            <li><strong>Random Activation</strong> - User accidentally activates switch, notices something happens</li>
            <li><strong>Intentional Activation</strong> - User purposefully activates switch to see effect</li>
            <li><strong>Timed Activation</strong> - User learns to activate at specific moments</li>
            <li><strong>Controlled Activation</strong> - User activates to select specific items (scanning!)</li>
        </ol>
    </section>

    <!-- Chapter 4 -->
    <section id="chapter-4">
        <h2>Chapter 4: Selection Sets</h2>

        <p>A <strong>Selection Set</strong> is all the items available for the user to choose from at any given time.</p>
        <p>Large selection sets are usually split into pages or groups, with link items that move between pages.</p>

        <h3>Presentation Formats</h3>

        <h4>1. Single Line Presentation</h4>
        <p>Items arranged in a single row (horizontal or vertical)</p>
        <p><strong>Best for:</strong> Small sets (&lt;10 items), simple choices</p>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Single Line Presentation</div>
            <div class="figure-caption">Figure 6. Single Line Presentation (e.g., clicker talking book style).</div>
        </div>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Linear scan of 4 colors
        </div>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-technique="point"
                scan-rate="1500"
                grid-cols="4"
                custom-items='[
                    {"label":"Red", "backgroundColor":"#ffcccc", "id":"red"},
                    {"label":"Blue", "backgroundColor":"#ccccff", "id":"blue"},
                    {"label":"Green", "backgroundColor":"#ccffcc", "id":"green"},
                    {"label":"Yellow", "backgroundColor":"#ffffcc", "id":"yellow"}
                ]'>
            </switch-scanner>
        </div>

        <h4>2. Flip Chart Presentation</h4>
        <p>Individual items (or groups) displayed one at a time, like turning cards in a rolodex.</p>
        <p><strong>Best for:</strong> Reducing visual distraction, step-by-step choices.</p>

        <div class="info-box" style="margin: 10px 0; padding: 10px;">
            The existence of other items is often indicated "behind" the current one. This helps users focus on one decision at a time.
        </div>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Flip Chart</div>
            <div class="figure-caption">Figure 7. Flip Chart Presentation (one item shown at a time).</div>
        </div>

        <h4>3. Grid Presentation</h4>
        <p>Items arranged in a 2D grid</p>
        <p><strong>Best for:</strong> Large sets, organized layouts</p>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Grid Presentation</div>
            <div class="figure-caption">Figure 8. Grid Presentation (classic AAC matrix layout).</div>
        </div>

        <h4>4. Pop-up / Secondary Page Presentation</h4>
        <p>Secondary pages appear <em>within</em> the current page temporarily, then disappear after one choice.</p>
        <p><strong>Best for:</strong> Contextual choices, quick sub-menus.</p>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Pop-up Presentation</div>
            <div class="figure-caption">Figure 9. Pop-up Presentation (temporary sub-page).</div>
        </div>

        <h4>5. Custom Presentation</h4>
        <p>Non-standard layouts that emphasize important items with size, color, or placement.</p>
        <p><strong>Best for:</strong> Prioritizing frequent choices or adapting to a specific task.</p>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Custom Presentation</div>
            <div class="figure-caption">Figure 10. Custom Presentation (prioritized items).</div>
        </div>

        <div class="demo-instructions">
            ğŸ® <strong>Compare:</strong> Try selecting number 59 in each grid below. Notice how much longer the 64-item grid takes!
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h5>16 Items (4Ã—4)</h5>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-technique="point"
                        scan-rate="800"
                        grid-size="16">
                    </switch-scanner>
                </div>
            </div>
            <div>
                <h5>64 Items (8Ã—8)</h5>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-technique="point"
                        scan-rate="800"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>
        </div>

        <div class="warning-box">
            <strong>âš ï¸ The Problem:</strong> Linear scanning of large sets is painfully slow!<br>
            â€¢ 16 items: Average cost = 8 presses<br>
            â€¢ 64 items: Average cost = 32 presses!<br>
            â€¢ 100 items: Average cost = 50 presses ğŸ˜±<br><br>
            <strong>Solution:</strong> <a href="#chapter-7">Grouping</a> (Chapter 7) dramatically reduces scan time.
        </div>
    </section>

    <!-- Chapter 5 -->
    <section id="chapter-5">
        <h2>Chapter 5: Single Switch Scanning</h2>

        <p><strong>Single Switch Scanning (Auto-Scan)</strong> is the most common scanning method.</p>

        <h3>How it works:</h3>
        <ol>
            <li>System automatically highlights items in sequence</li>
            <li>User waits for desired item to be highlighted</li>
            <li>User presses switch to select</li>
            <li>System activates item and restarts scan</li>
        </ol>

        <h3>Variants Youâ€™ll See in Real Devices</h3>
        <ul>
            <li><strong>Auto-while-held:</strong> The highlight moves only while the switch is held down.</li>
            <li><strong>Auto-restart modes:</strong> Restart from the first item or continue from last.</li>
            <li><strong>Initial item pause:</strong> Extra time on the first item to help users get ready.</li>
        </ul>

        <div class="demo-instructions">
            ğŸ® <strong>Challenge:</strong> Can you select the number 7?<br>
            Press <span class="key-badge">Space</span> when 7 is highlighted!
        </div>

        <div class="scanner-container">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-technique="point"
                scan-rate="1000"
                grid-size="9">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>ğŸ’¡ Timing Tips:</strong>
            <ul>
                <li><strong>Too fast</strong> = User misses items, can't react in time</li>
                <li><strong>Too slow</strong> = Frustrating, takes too long</li>
                <li><strong>Just right</strong> = User feels in control, not rushed</li>
            </ul>
        </div>

        <h3>The Auto-Scan Flow</h3>

        <div class="diagram">
            <pre style="background: white; color: #333;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Start Scan  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Highlight Item 1 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Switch  â”‚â—„â”€â”€â”€â”€ No â”€â”€â”€â”€â”
   â”‚Pressed? â”‚              â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚
        â”‚ Yes               â”‚
        â–¼                   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
   â”‚ Select  â”‚         â”‚ Wait Scan â”‚
   â”‚  Item   â”‚         â”‚   Rate    â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚
        â–¼                   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Restart  â”‚â—„â”€â”‚Highlight Next Itemâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
        </div>

        <h3>Alternative: Auto-While-Held (User Scan)</h3>

        <p>In standard Auto-Scan, the user presses the switch to <strong>stop/select</strong>. In <strong>Auto-While-Held</strong>, the logic is reversed:</p>

        <ul>
            <li><strong>Hold Switch:</strong> Scan moves forward.</li>
            <li><strong>Release Switch:</strong> Scan stops on current item (selection happens on release or after dwell).</li>
        </ul>

        <div class="highlight-box">
            <strong>Why use this?</strong> It gives the user direct control over the movement. If they panic or freeze, they likely release the switch, which stops the scan (rather than missing the item as it flies by).
        </div>
    </section>

    <!-- Chapter 6 -->
    <section id="chapter-6">
        <h2>Chapter 6: Two Switch Scanning</h2>

        <p><strong>Two Switch Scanning (Step Scan)</strong> gives the user more control over timing.</p>

        <h3>How it works:</h3>
        <ul>
            <li><strong>Switch 1 (Advance)</strong>: Move to next item - Key <span class="key-badge">2</span></li>
            <li><strong>Switch 2 (Select)</strong>: Choose current item - Key <span class="key-badge">Space</span></li>
        </ul>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Use <span class="key-badge">Key '2'</span> to move, <span class="key-badge">Space</span> to select!<br>
            Notice: No time pressure! Move at your own pace.
        </div>

        <div class="scanner-container">
            <switch-scanner
                theme="sketch"
                scan-input-mode="manual"
                scan-pattern="linear"
                scan-technique="point"
                grid-size="9"
                custom-items='[
                    {"label":"ğŸ Apple", "id":"apple"},
                    {"label":"ğŸŒ Banana", "id":"banana"},
                    {"label":"ğŸ‡ Grapes", "id":"grapes"},
                    {"label":"ğŸŠ Orange", "id":"orange"},
                    {"label":"ğŸ“ Strawberry", "id":"strawberry"},
                    {"label":"ğŸ‰ Watermelon", "id":"watermelon"},
                    {"label":"ğŸ‘ Peach", "id":"peach"},
                    {"label":"ğŸ’ Cherry", "id":"cherry"},
                    {"label":"ğŸ‹ Lemon", "id":"lemon"}
                ]'>
            </switch-scanner>
        </div>

        <h3>Comparison: Auto-Scan vs Step Scan</h3>

        <table class="comparison-table">
            <tr>
                <th>Feature</th>
                <th>Auto-Scan (1 Switch)</th>
                <th>Step Scan (2 Switches)</th>
            </tr>
            <tr>
                <td>Timing control</td>
                <td>System controls</td>
                <td>User controls âœ“</td>
            </tr>
            <tr>
                <td>Cognitive load</td>
                <td>Must watch timing</td>
                <td>No timing pressure âœ“</td>
            </tr>
            <tr>
                <td>Physical effort</td>
                <td>1 switch âœ“</td>
                <td>2 switches</td>
            </tr>
            <tr>
                <td>Speed</td>
                <td>Fixed</td>
                <td>Variable (user-paced) âœ“</td>
            </tr>
            <tr>
                <td>Best for</td>
                <td>Single switch users âœ“</td>
                <td>Users with good motor control âœ“</td>
            </tr>
        </table>

        <h3>Step Scan Alternation (Swap Switch)</h3>
        <p>Some systems swap switch roles after each selection to balance physical load. The switch used to select becomes the â€œadvanceâ€ switch on the next cycle.</p>
    </section>

    <!-- Chapter 7 -->
    <section id="chapter-7">
        <h2>Chapter 7: Why Group?</h2>

        <p><strong>The Problem:</strong> Linear scanning of large sets is painfully slow.</p>

        <h3>Scan Cost Calculation</h3>

        <p>For <strong>N</strong> items in linear scan:</p>
        <ul>
            <li>Average cost to select any item = <strong>N/2</strong></li>
            <li>Cost to select last item = <strong>N</strong></li>
        </ul>

        <h3>Example: 36 Items (6Ã—6 grid)</h3>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: #ffeaa7; padding: 15px; border-radius: 8px;">
                <h4>âŒ Linear Scan</h4>
                <p>Scan all 36 items one by one</p>
                <p><strong>Average cost: 18 presses</strong></p>
                <p><strong>Max cost: 36 presses</strong></p>
            </div>
            <div style="background: #d5f4e6; padding: 15px; border-radius: 8px;">
                <h4>âœ“ Row-Column Scan</h4>
                <p>Stage 1: Scan 6 rows (6 options)</p>
                <p>Stage 2: Scan 6 items in row (6 options)</p>
                <p><strong>Average cost: 9 presses</strong></p>
                <p><strong>Max cost: 12 presses</strong></p>
            </div>
        </div>

        <div class="highlight-box">
            <strong>ğŸ‰ That's 50% faster!</strong><br><br>
            By grouping items into rows, we dramatically reduce the scan cost.<br>
            This is the power of hierarchical scanning!
        </div>

        <h3>Hierarchy Visualization</h3>

        <div class="diagram">
            <pre style="background: white; color: #333;">
         Entire Selection Set (36 items)
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â”‚    â”‚    â”‚   â”‚
      Row1 Row2 Row3 Row4 Row5 Row6
       â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
      6    6    6    6    6    6
    items items items items items items
            </pre>
        </div>

        <p>Instead of 36 individual choices, we have:</p>
        <ol>
            <li><strong>First choice:</strong> Which row? (6 options)</li>
            <li><strong>Second choice:</strong> Which item in row? (6 options)</li>
        </ol>
    </section>

    <!-- Chapter 8 -->
    <section id="chapter-8">
        <h2>Chapter 8: Row-Column Scanning</h2>

        <p><strong>Row-Column Scanning</strong> is the most common grouped scanning method.</p>

        <h3>How It Works</h3>

        <p><strong>Stage 1: Row Selection</strong><br>
        System highlights each ROW. User selects desired row.</p>

        <p><strong>Stage 2: Item Selection</strong><br>
        System highlights items within selected ROW. User selects desired item.</p>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Watch the rows scan first, then items within the row!
        </div>

        <div class="scanner-container">
            <switch-scanner
                theme="sketch"
                scan-pattern="row-column"
                scan-technique="block"
                scan-rate="1000"
                grid-size="16">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>Observe:</strong>
            <ol>
                <li><strong>First pass:</strong> Rows highlight (entire rows light up)</li>
                <li><strong>Select a row:</strong> Now items within that row scan</li>
                <li><strong>Select item:</strong> Item activates, scan restarts</li>
            </ol>
        </div>

        <h3>Related Grouping Variants</h3>
        <ul>
            <li><strong>Column-Row Scan:</strong> Columns first, then items within a column.</li>
            <li><strong>Mixed Group Scan:</strong> Split into big regions first, then rows/columns within a region.</li>
        </ul>

        <h3>Block vs Point Technique</h3>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>Block Technique</h4>
                <p>Highlights ENTIRE row as solid block</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="block"
                        scan-rate="1500"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Easier to see, better for larger items</p>
            </div>
            <div>
                <h4>Point Technique</h4>
                <p>Highlights just the row indicator</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="point"
                        scan-rate="1500"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Less visual clutter, better for dense grids</p>
            </div>
        </div>
    </section>

    <!-- Chapter 9 -->
    <section id="chapter-9">
        <h2>Chapter 9: Progressive Segmenting & Elimination</h2>

        <p><strong>Progressive Segmenting</strong> is a strategy where the selection set is repeatedly divided (segmented) into smaller and smaller groups until the desired item is reached. This is often called <strong>Elimination Scanning</strong> because you actively eliminate large portions of the grid with each selection.</p>

        <h3>Common Techniques</h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>Halving (Binary Split)</h4>
                <p>Splits the grid into <strong>2 halves</strong>.</p>
                <p><strong>Switches needed:</strong> 2</p>
                <p><em>"Is it in the Left group or Right group?"</em></p>
            </div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>Quartering (Quadrant)</h4>
                <p>Splits the grid into <strong>4 quadrants</strong>.</p>
                <p><strong>Switches needed:</strong> 4</p>
                <p><em>"Is it Top-Left, Top-Right, Bottom-Left, or Bottom-Right?"</em></p>
            </div>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
                <h4>Scan Direct</h4>
                <p>Splits into many groups (6-9).</p>
                <p><strong>Switches needed:</strong> 6+</p>
                <p>Extremely fast but cognitively demanding.</p>
            </div>
        </div>

        <h3>How Elimination Works (Example: 64 Items)</h3>

        <p>Instead of scanning linearly, we dive deep quickly:</p>

        <ol>
            <li><strong>Stage 1:</strong> Grid splits into 4 quadrants â†’ You select one (Eliminating 48 items instantly!)</li>
            <li><strong>Stage 2:</strong> Selected quadrant splits into 4 sub-quadrants â†’ You select one (Eliminating 12 items)</li>
            <li><strong>Stage 3:</strong> Remaining 4 items shown â†’ You select the target</li>
        </ol>

        <p><strong>Result:</strong> Access any of 64 items in just <strong>3 selections</strong>!</p>

        <h3>Efficiency Comparison for 64 Items</h3>

        <table class="comparison-table">
            <tr>
                <th>Method</th>
                <th>Max Presses</th>
                <th>Average Presses</th>
                <th>Speed</th>
            </tr>
            <tr>
                <td>Linear</td>
                <td>64</td>
                <td>32</td>
                <td>Slow ğŸ˜´</td>
            </tr>
            <tr>
                <td>Row-Column (8Ã—8)</td>
                <td>16</td>
                <td>9</td>
                <td>Medium</td>
            </tr>
            <tr>
                <td>Elimination (4-switch)</td>
                <td><strong>3</strong></td>
                <td><strong>3</strong></td>
                <td><strong>Fast! ğŸš€</strong></td>
            </tr>
        </table>

        <div class="demo-instructions">
            ğŸ® <strong>Experience the speed!</strong><br>
            1. <strong>Stage 1:</strong> Grid splits into 4 colored quadrants. Press the corresponding switch/button.<br>
            2. <strong>Stage 2:</strong> Selected area splits again. Press the switch for the sub-quadrant.<br>
            3. <strong>Stage 3:</strong> Select the final item.<br>
            <em>Notice: You never "wait" for a scan. You drive the speed!</em>
        </div>

        <div class="scanner-container large">
            <switch-scanner
                theme="sketch"
                scan-pattern="elimination"
                elimination-switch-count="4"
                scan-rate="1500"
                grid-size="64">
            </switch-scanner>
        </div>

        <div class="info-box">
            <strong>ğŸ¯ Switch Count Trade-off:</strong><br>
            â€¢ <strong>2 Switches (Binary):</strong> Simple, but takes more steps (Logâ‚‚N). 64 items = 6 steps.<br>
            â€¢ <strong>4 Switches (Quadrant):</strong> Faster (Logâ‚„N). 64 items = 3 steps.<br>
            â€¢ <strong>8 Switches:</strong> Very fast (Logâ‚ˆN). 64 items = 2 steps.<br><br>
            <em>Rule of Thumb: Use the maximum number of switches the user can reliably control.</em>
        </div>
    </section>

    <!-- Chapter 10 -->
    <section id="chapter-10">
        <h2>Chapter 10: Pattern Comparison - Which is Fastest?</h2>

        <p>Different scanning patterns have dramatically different efficiency. Let's compare them directly!</p>

        <h3>Visualizing the Patterns</h3>

        <p>Instead of flowcharts, here are illustration placeholders we can later replace with the PDF-style sketches.</p>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Linear Scan Flow</div>
            <div class="figure-caption">Figure 11. Linear scanning cycle (highlight â†’ wait â†’ select).</div>
        </div>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Row-Column Flow</div>
            <div class="figure-caption">Figure 12. Row selection then item selection.</div>
        </div>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Elimination Flow</div>
            <div class="figure-caption">Figure 13. Quadrant elimination (4-switch).</div>
        </div>

        <h3>Interactive Comparison: Small Grid (16 items)</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Challenge:</strong> Time yourself selecting the number 15 with each pattern below.<br>
            Compare how long it takes and how many presses you need!
        </div>

        <h4>Pattern A: Linear Scan</h4>
        <p><strong>Theory:</strong> Scans all 16 items one by one</p>
        <p><strong>Max cost:</strong> 16 presses | <strong>Average:</strong> 8 presses</p>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-technique="point"
                scan-rate="800"
                grid-size="16">
            </switch-scanner>
        </div>

        <h4>Pattern B: Row-Column Scan</h4>
        <p><strong>Theory:</strong> Scans 4 rows, then 4 items in selected row</p>
        <p><strong>Max cost:</strong> 8 presses | <strong>Average:</strong> 5 presses</p>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="row-column"
                scan-technique="block"
                scan-rate="800"
                grid-size="16">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>ğŸ“Š Result:</strong> Row-Column is about <strong>37.5% faster</strong> than Linear for 16 items!<br>
            Linear: 8 presses average | Row-Column: 5 presses average
        </div>

        <h3>Interactive Comparison: Large Grid (64 items)</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Challenge:</strong> Try selecting number 63 with each pattern.<br>
            Notice the dramatic difference!
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div>
                <h4>Linear Scan (ğŸ˜´)</h4>
                <p style="font-size: 0.9em;"><strong>Max:</strong> 64 presses<br><strong>Avg:</strong> 32 presses</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-technique="point"
                        scan-rate="600"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>

            <div>
                <h4>Row-Column (ğŸ™‚)</h4>
                <p style="font-size: 0.9em;"><strong>Max:</strong> 16 presses<br><strong>Avg:</strong> 9 presses</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="block"
                        scan-rate="600"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>

            <div>
                <h4>Elimination (ğŸš€)</h4>
                <p style="font-size: 0.9em;"><strong>Max:</strong> 3 presses<br><strong>Avg:</strong> 3 presses</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="elimination"
                        elimination-switch-count="4"
                        scan-rate="1000"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>
        </div>

        <div class="info-box">
            <strong>ğŸ¤¯ Mind-blowing efficiency:</strong><br>
            â€¢ Linear: 32 presses average<br>
            â€¢ Row-Column: 9 presses average (72% faster!)<br>
            â€¢ Elimination: 3 presses average (91% faster!)<br><br>
            For a switch user, this means the difference between waiting 32 seconds vs 3 seconds to make a selection!
        </div>

        <h3>Pattern Selection Guide</h3>

        <table class="comparison-table">
            <tr>
                <th>Grid Size</th>
                <th>Recommended Pattern</th>
                <th>Why</th>
            </tr>
            <tr>
                <td>1-10 items</td>
                <td>Linear</td>
                <td>Simple, fast enough</td>
            </tr>
            <tr>
                <td>11-30 items</td>
                <td>Row-Column</td>
                <td>Good balance of speed and complexity</td>
            </tr>
            <tr>
                <td>31-100 items</td>
                <td>Row-Column OR Elimination</td>
                <td>Depends on user ability</td>
            </tr>
            <tr>
                <td>100+ items</td>
                <td>Elimination</td>
                <td>Only viable option for large grids</td>
            </tr>
        </table>

        <h3>Efficiency Comparison Chart</h3>
        <p>Here's a visual comparison of how many switch presses each pattern requires for different grid sizes:</p>
        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Efficiency Comparison Chart</div>
            <div class="figure-caption">Figure 14. Press count comparison across grid sizes and patterns.</div>
        </div>

        <p><strong>Key Insight:</strong> As grid size grows, Elimination scanning's advantage becomes dramatic!</p>
    </section>

    <!-- Chapter 11 -->
    <section id="chapter-11">
        <h2>Chapter 11: Efficiency Calculator</h2>

        <p>Want to know exactly how many switch presses it takes to select an item? Let's calculate!</p>

        <h3>Interactive Efficiency Calculator</h3>

        <p>See how different patterns, layouts, and techniques affect typing speed in real-time!</p>

        <div class="demo-box">
            <div class="demo-title">âš¡ Advanced Efficiency Calculator</div>

            <!-- Configuration Controls -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">Alphabet Layout:</label>
                        <select id="alphabetLayout" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="alphabetical">A B C D E F...</option>
                            <option value="frequency" selected>E T A O I N...</option>
                        </select>
                    </div>

                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">Grid Size:</label>
                        <select id="calcGridSize" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="26">26 letters (full alphabet)</option>
                            <option value="36" selected>36 items (6Ã—6)</option>
                            <option value="64">64 items (8Ã—8)</option>
                            <option value="100">100 items (10Ã—10)</option>
                        </select>
                    </div>

                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">Scan Pattern:</label>
                        <select id="calcPattern" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="linear">Linear</option>
                            <option value="row-column" selected>Row-Column</option>
                            <option value="elimination">Elimination (4-switch)</option>
                        </select>
                    </div>

                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">View Mode:</label>
                        <select id="calcViewMode" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="standard">Standard View</option>
                            <option value="cost-numbers" selected>Cost Numbers</option>
                            <option value="cost-heatmap">Cost Heatmap</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Sentence Typing Area -->
            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="margin-top: 0;">ğŸ’¬ Type a Sentence to See Costs:</h4>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="sentenceInput" placeholder="Type a sentence..." value="HELLO WORLD"
                           oninput="calculateSentenceCost()"
                           style="flex: 1; padding: 10px; font-size: 1.1em; border: 2px solid #3498db; border-radius: 4px;">
                    <button onclick="calculateSentenceCost()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                        Calculate
                    </button>
                </div>

                <div id="sentenceResult" style="padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #3498db;">
                    <em>Type a sentence and click "Calculate" to see the total cost breakdown!</em>
                </div>
            </div>

            <!-- Scanner Visualization -->
            <div style="background: white; padding: 20px; border-radius: 8px;">
                <h4 style="margin-top: 0;">ğŸ¯ Real-Time Scanner Preview:</h4>
                <div class="scanner-container large" style="min-height: 400px;">
                    <switch-scanner
                        id="calcScanner"
                        grid-content="keyboard"
                        language="en"
                        layout-mode="alphabetical"
                        grid-size="36"
                        scan-pattern="row-column"
                        scan-rate="500"
                        view-mode="cost-numbers">
                    </switch-scanner>
                </div>
            </div>
        </div>

        <h3>Real-World Example: Typing "THE"</h3>

        <p>Let's compare how long it takes to type common words using different alphabet layouts.</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: #ffeaa7; padding: 20px; border-radius: 8px;">
                <h4>ğŸ“ Alphabetical Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em;">A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</p>

                <div class="calculator-result">
                    <p><strong>Cost breakdown:</strong></p>
                    <ul>
                        <li>T = 20th position â†’ <strong>5 row + 20 presses</strong></li>
                        <li>H = 8th position â†’ <strong>3 row + 8 presses</strong></li>
                        <li>E = 5th position â†’ <strong>2 row + 5 presses</strong></li>
                    </ul>
                    <p><strong>Total: 43 presses</strong></p>
                    <p><em>At 1000ms scan rate: 43 seconds</em></p>
                </div>
            </div>

            <div style="background: #d5f4e6; padding: 20px; border-radius: 8px;">
                <h4>âš¡ Frequency Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em;">E T A O I N S H R D L C U M W F G Y P B V K J X Q Z</p>

                <div class="calculator-result">
                    <p><strong>Cost breakdown:</strong></p>
                    <ul>
                        <li>T = 2nd position â†’ <strong>1 row + 2 presses</strong></li>
                        <li>H = 9th position â†’ <strong>3 row + 9 presses</strong></li>
                        <li>E = 1st position â†’ <strong>1 row + 1 presses</strong></li>
                    </ul>
                    <p><strong>Total: 17 presses</strong></p>
                    <p><em>At 1000ms scan rate: 17 seconds</em></p>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <strong>ğŸ¯ Result:</strong> Frequency layout is <strong>60% faster</strong> for typing "THE"!<br>
            Alphabetical: 43 presses (43 seconds)<br>
            Frequency: 17 presses (17 seconds)<br>
            <strong>Time saved: 26 seconds per 3-letter word!</strong>
        </div>

        <h3>âš¡ Quick Examples - Try These Sentences!</h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
            <button onclick="trySentence('HELLO WORLD')" style="padding: 15px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ‘‹ HELLO WORLD
            </button>
            <button onclick="trySentence('I NEED HELP')" style="padding: 15px; background: #9b59b6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ†˜ I NEED HELP
            </button>
            <button onclick="trySentence('THANK YOU')" style="padding: 15px; background: #2ecc71; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ™ THANK YOU
            </button>
            <button onclick="trySentence('MY NAME IS')" style="padding: 15px; background: #e74c3c; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ‘¤ MY NAME IS
            </button>
            <button onclick="trySentence('YES NO')" style="padding: 15px; background: #f39c12; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                âœ… YES NO
            </button>
            <button onclick="trySentence('I AM HUNGRY')" style="padding: 15px; background: #1abc9c; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ I AM HUNGRY
            </button>
        </div>

        <h3>ğŸ“Š Compare: Alphabetical vs Frequency Layout</h3>

        <p>See the dramatic difference between alphabetical and frequency-based layouts!</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: #ffeaa7; padding: 20px; border-radius: 8px;">
                <h4>ğŸ“ Alphabetical Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em; word-break: break-all;">A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</p>

                <div class="calculator-result">
                    <p><strong>Typing "THE":</strong></p>
                    <ul>
                        <li>T = 20th â†’ <strong>5 + 20 = 25 presses</strong></li>
                        <li>H = 8th â†’ <strong>2 + 8 = 10 presses</strong></li>
                        <li>E = 5th â†’ <strong>2 + 5 = 7 presses</strong></li>
                    </ul>
                    <p><strong>Total: 42 presses (42 seconds)</strong></p>
                </div>
            </div>

            <div style="background: #d5f4e6; padding: 20px; border-radius: 8px;">
                <h4>âš¡ Frequency Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em; word-break: break-all;">E T A O I N S H R D L C U M W F G Y P B V K J X Q Z</p>

                <div class="calculator-result">
                    <p><strong>Typing "THE":</strong></p>
                    <ul>
                        <li>T = 2nd â†’ <strong>1 + 2 = 3 presses</strong></li>
                        <li>H = 9th â†’ <strong>3 + 9 = 12 presses</strong></li>
                        <li>E = 1st â†’ <strong>1 + 1 = 2 presses</strong></li>
                    </ul>
                    <p><strong>Total: 17 presses (17 seconds)</strong></p>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <strong>ğŸ¯ Result:</strong> Frequency layout is <strong>60% faster</strong> for "THE"!<br>
            Alphabetical: 42 presses | Frequency: 17 presses | <strong>Saved: 25 presses (25 seconds)!</strong>
        </div>

        <h3>Comparison Table: Common Words</h3>

        <table class="comparison-table">
            <tr>
                <th>Word</th>
                <th>Alphabetical<br/>(Row-Column)</th>
                <th>Frequency<br/>(Row-Column)</th>
                <th>Improvement</th>
            </tr>
            <tr>
                <td>THE</td>
                <td>42 presses (42s)</td>
                <td>17 presses (17s)</td>
                <td><strong>60% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>AND</td>
                <td>30 presses (30s)</td>
                <td>13 presses (13s)</td>
                <td><strong>57% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>YOU</td>
                <td>48 presses (48s)</td>
                <td>19 presses (19s)</td>
                <td><strong>60% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>THAT</td>
                <td>47 presses (47s)</td>
                <td>23 presses (23s)</td>
                <td><strong>51% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>HELLO</td>
                <td>60 presses (60s)</td>
                <td>30 presses (30s)</td>
                <td><strong>50% faster âœ…</strong></td>
            </tr>
        </table>

        <p style="text-align: center; margin: 20px 0;">
            <em>* Using Row-Column scanning at 1000ms rate | Try different patterns in the calculator above!</em>
        </p>

        <div class="info-box">
            <strong>ğŸ’¡ Key Insight:</strong> Over a day of typing, frequency-based layouts can save <strong>THOUSANDS of switch presses</strong>!<br>
            This dramatically reduces fatigue and increases communication speed.<br><br>
            <strong>ğŸ¯ Try it:</strong> Use the calculator above to type your own sentences and see real costs with different patterns!
        </div>
    </section>

    <!-- Chapter 12 -->
    <section id="chapter-12">
        <h2>Chapter 12: Patterns & Modes Hub</h2>

        <p>This is the one-stop reference for <strong>patterns</strong> (how items are organized) and <strong>modes</strong> (specialized scanning behaviors).</p>

        <h3>Patterns (Structure)</h3>
        <ul>
            <li><strong>Linear:</strong> Item-by-item scan.</li>
            <li><strong>Row-Column:</strong> Rows first, then items within a row.</li>
            <li><strong>Progressive Segmenting / Elimination:</strong> Repeatedly split until target remains.</li>
        </ul>

        <h3>Modes (Behavior)</h3>
        <ul>
            <li><strong>Continuous:</strong> Smooth, mouse-like movement (Chapter 16).</li>
            <li><strong>Probability (PPM):</strong> Items scan by likelihood, not position.</li>
            <li><strong>Cause-Effect:</strong> Single-item training mode.</li>
            <li><strong>Group-Row-Column:</strong> Explicit group stage before rows/columns.</li>
        </ul>

        <div class="info-box">
            <strong>Quick links:</strong> 
            <a href="#chapter-10">Pattern Comparison</a> Â·
            <a href="#chapter-11">Efficiency Calculator</a> Â·
            <a href="#chapter-15">Block vs Point</a> Â·
            <a href="#chapter-16">Continuous</a> Â·
            <a href="#chapter-17">Critical Overscan</a> Â·
            <a href="#chapter-18">Directed</a>
        </div>
    </section>

    <!-- Chapter 13 -->
    <section id="chapter-13">
        <h2>Chapter 13: Timing & Optimization (.65 Rule)</h2>

        <p>Finding the right scan rate is crucial. Too fast = errors. Too slow = frustration.</p>

        <h3>Interactive Rate Comparison</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Try all three speeds</strong> - Which feels most comfortable?<br>
            Notice how your ability to keep up changes!
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
            <div>
                <h4>ğŸ¢ Slow (2000ms)</h4>
                <p>Best for: Beginners, users with slow reaction time</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="2000"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Easy to keep up, low stress<br><strong>Cons:</strong> Takes a long time</p>
            </div>

            <div>
                <h4>ğŸš¶ Medium (1000ms)</h4>
                <p>Best for: Most intermediate users</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1000"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Good balance<br><strong>Cons:</strong> Some users may feel rushed</p>
            </div>

            <div>
                <h4>ğŸ‡ Fast (500ms)</h4>
                <p>Best for: Advanced users with fast reaction time</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="500"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Very fast selections<br><strong>Cons:</strong> High error rate for most users</p>
            </div>
        </div>

        <h3>Timing Guidelines by User Profile</h3>

        <table class="comparison-table">
            <tr>
                <th>User Profile</th>
                <th>Recommended Rate</th>
                <th>Reason</th>
            </tr>
            <tr>
                <td>Beginner</td>
                <td>1500-2000ms</td>
                <td>Learning curve, building confidence</td>
            </tr>
            <tr>
                <td>Intermediate</td>
                <td>1000-1500ms</td>
                <td>Balance of speed and accuracy</td>
            </tr>
            <tr>
                <td>Advanced</td>
                <td>500-1000ms</td>
                <td>Maximum efficiency</td>
            </tr>
            <tr>
                <td>Motor impairment (tremors)</td>
                <td>1500ms + 500ms acceptance time</td>
                <td>Filter out tremors, allow reaction</td>
            </tr>
            <tr>
                <td>Visual impairment</td>
                <td>1000-1500ms + audio</td>
                <td>Need time for audio feedback</td>
            </tr>
            <tr>
                <td>Cognitive impairment</td>
                <td>1500-2000ms</td>
                <td>More thinking time needed</td>
            </tr>
            <tr>
                <td>Fatigue (MND/ALS progression)</td>
                <td>Morning: 1000ms, Afternoon: 1500ms</td>
                <td>Accommodate energy changes</td>
            </tr>
        </table>

        <h3>The .65 Rule (Research-Based Starting Point)</h3>
        <p>Research on single-switch row-column scanning suggests that a good initial <strong>scan rate</strong> is about <strong>65% of a user's mean reaction time</strong>. This is commonly called the <strong>.65 rule</strong>.</p>
        <p><strong>Rule of thumb:</strong> <code>Scan Rate â‰ˆ Mean Reaction Time Ã· 0.65</code> (roughly 1.54Ã— the reaction time).</p>
        <p>If the userâ€™s press times are highly variable, a faster scan rate will create errors. In those cases, increase the scan rate or add acceptance time to reduce timing mistakes.</p>

        <div class="info-box">
            <strong>Practical takeaway:</strong> Use the .65 rule to get into the right neighborhood, then adjust based on accuracy, fatigue, and user preference.
        </div>

        <h3>Acceptance Time & Selection Confirmation</h3>
        <p><strong>Acceptance time</strong> is a small delay that confirms a switch press before selection is finalized. It reduces accidental triggers from tremors or double-taps.</p>
        <ul>
            <li><strong>Short (150-300ms):</strong> Good for advanced users.</li>
            <li><strong>Medium (300-600ms):</strong> Good default.</li>
            <li><strong>Long (600-1000ms):</strong> Useful for users with tremors.</li>
        </ul>

        <h3>Reaction Time Quick Test (3 trials)</h3>
        <p>Use this quick test to estimate a starting autoscan rate. Start the test, then hit the switch (or Space key) as soon as you hear the ding and see the smiley face.</p>

        <div class="reaction-test" id="reactionTest">
            <div class="reaction-display" id="reactionDisplay">ğŸ™‚ Ready?</div>
            <div class="button-row">
                <button id="reactionStart">Start Test</button>
                <button class="secondary" id="reactionReset">Reset</button>
            </div>
            <p><strong>Trial:</strong> <span id="reactionTrial">0</span> / 3</p>
            <p><strong>Last Reaction Time:</strong> <span id="reactionLast">â€”</span></p>
            <p><strong>Average Reaction Time:</strong> <span id="reactionAvg">â€”</span></p>
            <p><strong>Recommended Scan Rate (.65 rule):</strong> <span id="reactionRate">â€”</span></p>
            <p style="color: var(--ink-soft); margin-top: 6px;">Tip: Use the Space bar to respond once the test starts.</p>
        </div>

        <h3>Scan Time Estimator</h3>
        <p>This quick estimator combines your scan rate with a scan pattern to predict average time per selection.</p>

        <div class="reaction-test" id="scanEstimator">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px;">
                <label>
                    <strong>Scan Rate (ms)</strong><br>
                    <input id="estimateScanRate" type="number" min="200" max="5000" value="1000" style="width: 100%; padding: 8px; margin-top: 6px;">
                </label>
                <label>
                    <strong>Grid Size (items)</strong><br>
                    <input id="estimateGridSize" type="number" min="4" max="200" value="36" style="width: 100%; padding: 8px; margin-top: 6px;">
                </label>
                <label>
                    <strong>Pattern</strong><br>
                    <select id="estimatePattern" style="width: 100%; padding: 8px; margin-top: 6px;">
                        <option value="linear">Linear</option>
                        <option value="row-column">Row-Column</option>
                        <option value="elimination">Elimination</option>
                    </select>
                </label>
                <label>
                    <strong>Elimination Switches</strong><br>
                    <input id="estimateSwitches" type="number" min="2" max="8" value="4" style="width: 100%; padding: 8px; margin-top: 6px;">
                </label>
            </div>
            <div class="button-row" style="margin-top: 12px;">
                <button id="estimateUseReaction">Use Reaction Avg</button>
                <button class="secondary" id="estimateReset">Reset</button>
            </div>
            <p><strong>Estimated Avg Presses:</strong> <span id="estimatePresses">â€”</span></p>
            <p><strong>Estimated Time per Selection:</strong> <span id="estimateTime">â€”</span></p>
        </div>

        <h3>Advanced Timing: Critical Overscan</h3>

        <p>For users who can react quickly but need to scan large lists without groups, <strong>Critical Overscan</strong> is a powerful technique.</p>
        <p><em>See Chapter 17 for a dedicated walkthrough and design considerations.</em></p>

        <p><strong>How it works:</strong></p>
        <ol>
            <li><strong>Stage 1 (Fast):</strong> Scan moves VERY fast (e.g., 200ms).</li>
            <li><strong>User Action:</strong> User presses switch when the target is <em>roughly</em> near.</li>
            <li><strong>Stage 2 (Slow):</strong> Scan slows down significantly (e.g., 1000ms) and often backs up a few steps.</li>
            <li><strong>Selection:</strong> User selects the exact item at the slower speed.</li>
        </ol>

        <div class="info-box">
            This allows a linear scan of 50 items to be traversed in seconds, without the complexity of row-column patterns!
        </div>

        <h3>Dwell Selection Demo</h3>

        <p>Dwell time allows selection without pressing a switch - just wait on the item!</p>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Just wait on an item for 2 seconds - it will auto-select!<br>
            No switch press needed. Great for users who can't reliably press switches.
        </div>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                dwell-time="2000"
                scan-rate="1500"
                grid-size="9">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>ğŸ’¡ When to use dwell selection:</strong><br>
            â€¢ User has consistent movement but unreliable switch activation<br>
            â€¢ Reducing physical fatigue<br>
            â€¢ Head tracking or eye tracking systems<br>
            â€¢ "Hands-free" scanning requirement
        </div>

        <h3>Scan Loops Demo</h3>

        <p>Should scanning continue forever, or stop after a few cycles?</p>

        <div class="demo-instructions">
            ğŸ® <strong>Compare:</strong> Watch how infinite scanning keeps going, while 2-loop scanning stops and waits.<br>
            Notice which feels less anxiety-producing!
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>â™¾ï¸ Infinite Loops (0)</h4>
                <p>Scanning never stops - can feel endless</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1000"
                        scan-loops="0"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Infinite chances<br><strong>Cons:</strong> Can feel endless, anxiety</p>
            </div>

            <div>
                <h4>ğŸ”„ Two Loops (2)</h4>
                <p>Scans twice, then stops and waits</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1000"
                        scan-loops="2"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Predictable, less anxiety<br><strong>Cons:</strong> Might miss item if distracted</p>
            </div>
        </div>

        <div class="info-box">
            <strong>ğŸ“Š Success Probability:</strong><br>
            With 2 loops and 90% success rate: 1 - (0.10Â²) = 99% success probability!<br>
            With 4 loops and 90% success rate: 1 - (0.10â´) = 99.99% success probability!
        </div>
    </section>

    <!-- Chapter 14 -->
    <section id="chapter-14">
        <h2>Chapter 14: Visualization Options</h2>

        <p>How the highlight looks matters! Let's explore different visualization options.</p>
        <p><em>For auditory and tactile feedback, see Chapter 20.</em></p>

        <h3>Interactive: Border Width Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Compare the three options below - which is most visible to you?
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div>
                <h4>Thin (2px)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-border-width="2">
                    </switch-scanner>
                </div>
                <p>Subtle, may be hard to see</p>
            </div>

            <div>
                <h4>Medium (4px) - Default</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-border-width="4">
                    </switch-scanner>
                </div>
                <p>Good balance of visibility</p>
            </div>

            <div>
                <h4>Thick (8px)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-border-width="8">
                    </switch-scanner>
                </div>
                <p>Very visible, great for low vision</p>
            </div>
        </div>

        <h3>Interactive: Scale (Zoom) Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Notice how the highlighted items grow larger with higher scale values!
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>No Zoom (Scale 1.0)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-scale="1.0">
                    </switch-scanner>
                </div>
            </div>

            <div>
                <h4>20% Zoom (Scale 1.2)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-scale="1.2">
                    </switch-scanner>
                </div>
                <p>Makes items easier to see!</p>
            </div>
        </div>

        <h3>Interactive: Animation Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Compare static vs animated highlighting - which draws your attention better?
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>Static (No Animation)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-animation="false">
                    </switch-scanner>
                </div>
                <p>Simple, clear, less distraction</p>
            </div>

            <div>
                <h4>Pulse Animation</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-animation="true">
                    </switch-scanner>
                </div>
                <p>Draws attention, good for low vision</p>
            </div>
        </div>

        <h3>Visualization Recommendations</h3>

        <table class="comparison-table">
            <tr>
                <th>User Need</th>
                <th>Recommended Settings</th>
            </tr>
            <tr>
                <td>Low Vision</td>
                <td>Thick borders (6-8px), Scale 1.2-1.3, Animation ON, High contrast colors</td>
            </tr>
            <tr>
                <td>Cognitive Impairment</td>
                <td>Medium borders (4px), Scale 1.0-1.1, Animation OFF (distracting)</td>
            </tr>
            <tr>
                <td>Beginner</td>
                <td>Thick borders (6px), Scale 1.2, Animation ON (helps tracking)</td>
            </tr>
            <tr>
                <td>Advanced/Power User</td>
                <td>Thin borders (2-4px), Scale 1.0, Animation OFF (minimal distraction)</td>
            </tr>
            <tr>
                <td>Distractible</td>
                <td>Thick borders, Scale 1.1, Animation OFF, Low opacity on non-highlighted</td>
            </tr>
        </table>
    </section>

    <!-- Chapter 15 -->
    <section id="chapter-15">
        <h2>Chapter 15: Block vs Point Technique</h2>

        <p>When using row-column scanning, how should groups be highlighted?</p>

        <h3>Interactive Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Watch how the two techniques highlight rows differently!<br>
            Which is easier for you to follow?
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>Block Technique</h4>
                <p>Entire row lights up as solid block</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="block"
                        scan-rate="1500"
                        grid-size="16">
                    </switch-scanner>
                </div>
                <div class="highlight-box">
                    <strong>âœ… Pros:</strong>
                    <ul>
                        <li>Easy to see</li>
                        <li>Clear group boundaries</li>
                        <li>Less visual searching</li>
                        <li>Better for beginners</li>
                    </ul>
                </div>
                <div class="warning-box">
                    <strong>âŒ Cons:</strong>
                    <ul>
                        <li>Can overwhelm visually</li>
                        <li>Harder to see individual items</li>
                        <li>More visual "noise"</li>
                    </ul>
                </div>
            </div>

            <div>
                <h4>Point Technique</h4>
                <p>Only row indicator highlights</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="point"
                        scan-rate="1500"
                        grid-size="16">
                    </switch-scanner>
                </div>
                <div class="highlight-box">
                    <strong>âœ… Pros:</strong>
                    <ul>
                        <li>Less visual clutter</li>
                        <li>Easier to focus</li>
                        <li>Better for dense grids</li>
                        <li>Preferred by experienced users</li>
                    </ul>
                </div>
                <div class="warning-box">
                    <strong>âŒ Cons:</strong>
                    <ul>
                        <li>Harder to see boundaries</li>
                        <li>Less intuitive</li>
                        <li>Requires abstract thinking</li>
                        <li>Can be confusing at first</li>
                    </ul>
                </div>
            </div>
        </div>

        <h3>Decision Tree: Which Technique?</h3>

        <div class="diagram">
            <pre style="background: white; color: #333;">
Does user have low vision?
â”œâ”€ Yes â†’ Use BLOCK technique
â””â”€ No
   â”œâ”€ Are items large icons/images?
   â”‚  â”œâ”€ Yes â†’ Use BLOCK technique
   â”‚  â””â”€ No
   â”‚     â”œâ”€ Is grid dense (>64 items)?
   â”‚     â”‚  â”œâ”€ Yes â†’ Use POINT technique
   â”‚     â””â”€ No â†’ User preference
   â””â”€ Is user a beginner?
      â”œâ”€ Yes â†’ Start with BLOCK
      â””â”€ No â†’ User preference
            </pre>
        </div>

        <h3>Real-World Recommendation</h3>

        <div class="info-box">
            <strong>ğŸ’¡ Best Practice:</strong> Start with BLOCK technique for all beginners.<br>
            Once user is comfortable (after 2-4 weeks), try POINT technique and see what they prefer.<br><br>
            Many users eventually prefer POINT for faster scanning, but BLOCK is essential for learning!
        </div>
    </section>

    <!-- Chapter 16 -->
    <section id="chapter-16">
        <h2>Chapter 16: Continuous Scanning</h2>

        <p><strong>Continuous scanning</strong> moves the focus smoothly rather than stepping item-by-item. It can feel more like joystick control and helps some users target mid-grid items faster.</p>

        <h3>Common Techniques</h3>
        <ul>
            <li><strong>Gliding cursor:</strong> A highlight moves across the grid and wraps at edges.</li>
            <li><strong>Crosshair:</strong> Horizontal and vertical scans intersect on the target.</li>
            <li><strong>Compass (8-direction):</strong> The focus moves in eight directions with directional inputs.</li>
        </ul>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Continuous Scanning</div>
            <div class="figure-caption">Figure 15. Continuous scanning styles (glide, crosshair, compass).</div>
        </div>

        <h3>Interactive Demos</h3>
        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Observe how each continuous technique moves focus.
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px;">
            <div>
                <h4>Gliding Cursor</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-mode="continuous"
                        continuous-technique="gliding"
                        grid-size="16">
                    </switch-scanner>
                </div>
            </div>
            <div>
                <h4>Crosshair</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-mode="continuous"
                        continuous-technique="crosshair"
                        grid-size="16">
                    </switch-scanner>
                </div>
            </div>
            <div>
                <h4>Compass (Fixed-8)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-mode="continuous"
                        continuous-technique="eight-direction"
                        compass-mode="fixed-8"
                        grid-size="16">
                    </switch-scanner>
                </div>
            </div>
        </div>

        <div class="info-box">
            <strong>Tip:</strong> Continuous scanning is highly timing-sensitive. If users miss targets, slow the scan rate or add an acceptance time buffer.
        </div>
    </section>

    <!-- Chapter 17 -->
    <section id="chapter-17">
        <h2>Chapter 17: Critical Overscan</h2>

        <p><strong>Critical overscan</strong> accelerates the first pass and slows down on demand. Users â€œcatchâ€ the target as it passes, then the system backs up or slows for precise selection.</p>

        <h3>When Itâ€™s Useful</h3>
        <ul>
            <li>Very large linear lists</li>
            <li>Users with fast reaction times</li>
            <li>Situations where grouping adds too much cognitive load</li>
        </ul>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Critical Overscan</div>
            <div class="figure-caption">Figure 16. Fast forward scan with slow-back precision selection.</div>
        </div>

        <h3>Interactive Demo</h3>
        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Press when your target passes, then select precisely on the slow return.
        </div>
        <div class="scanner-container">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                critical-overscan-enabled="true"
                critical-overscan-fast-rate="200"
                critical-overscan-slow-rate="1200"
                grid-size="36">
            </switch-scanner>
        </div>

        <div class="info-box">
            <strong>Design note:</strong> Consider limiting the number of slow-back passes before restarting the fast scan.
        </div>
    </section>

    <!-- Chapter 18 -->
    <section id="chapter-18">
        <h2>Chapter 18: Directed Scanning</h2>

        <p><strong>Directed scanning</strong> allows users to steer the highlight using directional switches (up/down/left/right or diagonals).</p>

        <h3>Switch Configurations</h3>
        <ul>
            <li><strong>Full directional:</strong> One switch per direction (natural, direct).</li>
            <li><strong>Reduced switch:</strong> Right + Down only, with wrap-around.</li>
            <li><strong>Rotating arrow:</strong> Direction options rotate, user confirms direction.</li>
        </ul>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Directed Scanning</div>
            <div class="figure-caption">Figure 17. Directional steering models.</div>
        </div>

        <h3>Interactive Demos</h3>
        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Use arrow keys (or watch auto-steer) to move focus.
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px;">
            <div>
                <h4>Compass (Fixed-8)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-mode="continuous"
                        continuous-technique="eight-direction"
                        compass-mode="fixed-8"
                        grid-size="16">
                    </switch-scanner>
                </div>
            </div>
            <div>
                <h4>Compass (Fluid)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-mode="continuous"
                        continuous-technique="eight-direction"
                        compass-mode="continuous"
                        grid-size="16">
                    </switch-scanner>
                </div>
            </div>
        </div>
    </section>

    <!-- Chapter 19 -->
    <section id="chapter-19">
        <h2>Chapter 19: Error Recovery</h2>

        <p>For switch users, errors can cost many seconds. Design for fast recovery.</p>

        <h3>Recovery Tools</h3>
        <ul>
            <li><strong>Empty items:</strong> Selectable â€œdo nothingâ€ items that reset the scan.</li>
            <li><strong>Cancel scan:</strong> A dedicated cancel action (button, long-hold, or special item).</li>
            <li><strong>Undo/redo:</strong> Reverse the last character or action.</li>
            <li><strong>Back navigation:</strong> Return to the previous page/group.</li>
        </ul>

        <div class="info-box">
            <strong>Recommended:</strong> Offer a long-hold cancel and a visible back/undo in every grid.
        </div>

        <h3>Interactive Demo: Empty Item Reset</h3>
        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Select the â€œResetâ€ item. It performs no action and restarts the scan.
        </div>
        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-rate="1200"
                grid-cols="4"
                custom-items='[
                    {"label":"YES", "id":"yes"},
                    {"label":"NO", "id":"no"},
                    {"label":"âŸ³ Reset", "id":"reset", "isEmpty": true, "backgroundColor":"#fff3cd"},
                    {"label":"Undo", "id":"undo", "backgroundColor":"#e8f5e9"}
                ]'>
            </switch-scanner>
        </div>

        <h3>Interactive Demo: Long-Hold Cancel</h3>
        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Hold the switch for 1 second to cancel and reset the scan.
        </div>
        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="row-column"
                scan-technique="block"
                scan-rate="1200"
                cancel-method="long-hold"
                long-hold-time="1000"
                grid-size="16">
            </switch-scanner>
        </div>

        <h3>Interactive Demo: Undo & Backspace</h3>
        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Enter a few letters, then use Backspace or Undo/Redo.
        </div>
        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-rate="900"
                grid-cols="4"
                custom-items='[
                    {"label":"A", "id":"A"},
                    {"label":"B", "id":"B"},
                    {"label":"C", "id":"C"},
                    {"label":"Space", "id":"Space"},
                    {"label":"Backspace", "id":"Backspace", "backgroundColor":"#ffe0b2"},
                    {"label":"Undo", "id":"Undo", "backgroundColor":"#e3f2fd"},
                    {"label":"Redo", "id":"Redo", "backgroundColor":"#e3f2fd"},
                    {"label":"Clear", "id":"Clear", "backgroundColor":"#ffcdd2"}
                ]'>
            </switch-scanner>
        </div>
    </section>

    <!-- Chapter 20 -->
    <section id="chapter-20">
        <h2>Chapter 20: Feedback & Highlighting</h2>

        <p>Effective feedback helps users track focus and avoid errors.</p>

        <h3>Visual Feedback</h3>
        <ul>
            <li>Color shift or border glow on focus</li>
            <li>Scale-up or pulse animation</li>
            <li>Dim non-focused items</li>
        </ul>

        <h3>Auditory & Tactile Feedback</h3>
        <ul>
            <li>Tick or beep per highlight</li>
            <li>Voice output of item labels</li>
            <li>Haptic click or vibration (if available)</li>
        </ul>

        <div class="info-box">
            <strong>Clinical tip:</strong> Pair a visual highlight with a short, consistent sound to reduce cognitive load.
        </div>
    </section>

    <!-- Chapter 21 -->
    <section id="chapter-21">
        <h2>Chapter 21: User Profiles</h2>

        <p>Different users need different configurations. Start with a profile, then tune.</p>

        <h3>Example Profiles</h3>
        <ul>
            <li><strong>Athetosis:</strong> Long acceptance time, debounce filters, slower scan.</li>
            <li><strong>Degenerative conditions:</strong> Adjustable speeds + fatigue-aware presets.</li>
            <li><strong>Low vision:</strong> High contrast, thick borders, large scale.</li>
            <li><strong>Cognitive load:</strong> Small grids, clear grouping, short scan loops.</li>
        </ul>
    </section>

    <!-- Chapter 22 -->
    <section id="chapter-22">
        <h2>Chapter 22: Implementing Scanners</h2>

        <p>For developers: keep scanning logic deterministic and configuration-driven.</p>

        <h3>Settings Optimization (Koester & Simpson 2014)</h3>
        <p>This method uses a structured decision tree to improve text entry rate (TER). A key rule is the <strong>25% scanning error threshold</strong>: if errors exceed 25% of correct selections, focus on reducing errors before optimizing efficiency.</p>

        <div class="figure-card">
            <img src="/figures/koester-simpson-2014-flowchart.svg" alt="Koester and Simpson 2014 settings optimization flowchart" style="width: 100%; height: auto; display: block;">
            <div class="figure-caption">Figure 19. Decision tree for identifying revised scanning settings (Koester &amp; Simpson, 2014).</div>
        </div>

        <div class="info-box">
            <strong>Summary:</strong> Fix switch consistency â†’ measure scanning errors â†’ if &gt;25% focus on timing and initiation; if &lt;=25% focus on reducing dead time, improving prediction use, and optimizing layout.
        </div>

        <h3>Settings Advisor (Prototype)</h3>
        <p>Enter measured data to get a suggested next step. This is a lightweight implementation of the 2014 decision tree for developers and clinicians.</p>

        <div class="reaction-test" id="settingsAdvisor">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px;">
                <label>
                    <strong>Performance OK?</strong><br>
                    <select id="advisorPerformance" style="width: 100%; padding: 8px; margin-top: 6px;">
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </label>
                <label>
                    <strong>TER/Errors can improve?</strong><br>
                    <select id="advisorImprove" style="width: 100%; padding: 8px; margin-top: 6px;">
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </label>
                <label>
                    <strong>Scanning Errors (%)</strong><br>
                    <input id="advisorErrors" type="number" min="0" max="200" value="30" style="width: 100%; padding: 8px; margin-top: 6px;">
                </label>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; margin-top: 12px;">
                <label><input type="checkbox" id="advisorFirstLate"> First press too late</label>
                <label><input type="checkbox" id="advisorNextLate"> Next press too late</label>
                <label><input type="checkbox" id="advisorUnintentional"> Unintentional presses</label>
                <label><input type="checkbox" id="advisorMissingRow"> Missing first-row selections</label>
                <label><input type="checkbox" id="advisorDeadTime"> Too much dead time</label>
                <label><input type="checkbox" id="advisorWordPred"> Inefficient word prediction</label>
                <label><input type="checkbox" id="advisorLayout"> Inefficient layout/pattern</label>
            </div>
            <div class="button-row" style="margin-top: 12px;">
                <button id="advisorRun">Get Recommendations</button>
            </div>
            <p><strong>Summary:</strong> <span id="advisorSummary">â€”</span></p>
            <div id="advisorResults"></div>
        </div>

        <h3>Implementation Checklist</h3>
        <ul>
            <li>Separate <strong>scan state</strong> from <strong>rendering</strong>.</li>
            <li>Support <strong>pause/resume</strong> and <strong>restart</strong> modes.</li>
            <li>Allow <strong>manual start</strong> vs <strong>auto-start</strong> behavior.</li>
            <li>Expose timing parameters: scan rate, acceptance time, initial pause.</li>
            <li>Allow configurable grouping and ordering.</li>
        </ul>

        <div class="figure-card">
            <div class="figure-placeholder">Illustration Placeholder: Scanner Architecture</div>
            <div class="figure-caption">Figure 18. Suggested scanner architecture (state machine + renderer).</div>
        </div>
    </section>

    <!-- Chapter 23 -->
    <section id="chapter-23">
        <h2>Chapter 23: Accessibility Testing</h2>

        <h3>Testing Modes</h3>
        <ul>
            <li><strong>Single-switch simulation:</strong> Use Space only.</li>
            <li><strong>Timing sweeps:</strong> Test at slow/medium/fast rates.</li>
            <li><strong>Error drills:</strong> Practice undo, cancel, and recovery.</li>
            <li><strong>Fatigue runs:</strong> 20-30 minutes sustained use.</li>
        </ul>

        <div class="warning-box">
            <strong>Red flag:</strong> If it takes more than 2 scan cycles to recover from a mistake, users will abandon the system.
        </div>
    </section>

    <!-- Chapter 24 -->
    <section id="chapter-24">
        <h2>Chapter 24: Design Patterns</h2>

        <h3>Patterns That Work</h3>
        <ul>
            <li><strong>Progressive disclosure:</strong> Show only whatâ€™s needed now.</li>
            <li><strong>Most recently used (MRU):</strong> Prioritize recent items.</li>
            <li><strong>Predictive order:</strong> Frequency-based layouts.</li>
            <li><strong>Context-aware grids:</strong> Change set based on task state.</li>
        </ul>

        <div class="info-box">
            <strong>Reminder:</strong> Efficiency gains reduce fatigue, which matters as much as speed.
        </div>
    </section>

    <!-- Appendix B -->
    <section id="appendix-glossary">
        <h2>Appendix B: Glossary</h2>

        <div class="glossary-term" id="glossary-term-acceptance-time">
            <strong>Acceptance Time</strong>: The time a switch must be held before a selection is confirmed.
        </div>
        <div class="glossary-term" id="glossary-term-auto-scan">
            <strong>Auto-Scan</strong>: The system automatically advances the highlight at a set rate.
        </div>
        <div class="glossary-term" id="glossary-term-continuous-scan">
            <strong>Continuous Scanning</strong>: Focus moves smoothly rather than stepping item-by-item.
        </div>
        <div class="glossary-term" id="glossary-term-critical-overscan">
            <strong>Critical Overscan</strong>: Fast forward scan with slow-back precision selection.
        </div>
        <div class="glossary-term" id="glossary-term-directed-scan">
            <strong>Directed Scanning</strong>: User steers the highlight using directional switches.
        </div>
        <div class="glossary-term" id="glossary-term-dwell-time">
            <strong>Dwell Time</strong>: Auto-select when the highlight stays on an item for a threshold duration.
        </div>
        <div class="glossary-term" id="glossary-term-elimination-scan">
            <strong>Elimination Scanning</strong>: Repeatedly split the set until the target remains.
        </div>
        <div class="glossary-term" id="glossary-term-group-scan">
            <strong>Group Scan</strong>: Select a group first, then scan within that group.
        </div>
        <div class="glossary-term" id="glossary-term-input-bandwidth">
            <strong>Input Bandwidth</strong>: The amount of information a user can transmit per unit time.
        </div>
        <div class="glossary-term" id="glossary-term-row-column">
            <strong>Row-Column Scanning</strong>: Scan rows, then scan items in the selected row.
        </div>
        <div class="glossary-term" id="glossary-term-scan-rate">
            <strong>Scan Rate</strong>: Time each item stays highlighted.
        </div>
        <div class="glossary-term" id="glossary-term-selection-set">
            <strong>Selection Set</strong>: All the items available for selection at a given time.
        </div>
        <div class="glossary-term" id="glossary-term-step-scan">
            <strong>Step Scan</strong>: User controls movement and selection.
        </div>
        <div class="glossary-term" id="glossary-term-switch">
            <strong>Switch</strong>: A binary input device (on/off).
        </div>
    </section>

    <!-- Feedback Element -->
    <div id="feedback"></div>

    <script type="module" src="/src/main.ts"></script>
    <script>
        // Force scrollbar visibility and proper scrolling
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure document is scrollable
            const ensureScrollable = () => {
                const docHeight = document.documentElement.scrollHeight;
                const winHeight = window.innerHeight;

                if (docHeight > winHeight) {
                    document.documentElement.style.overflowY = 'auto';
                    document.body.style.overflowY = 'auto';
                }

                console.log('Document height:', docHeight, 'Window height:', winHeight);
            };

            // Check on load
            ensureScrollable();

            // Check after a short delay (for web components to render)
            setTimeout(ensureScrollable, 500);

            // Check again after images/components load
            window.addEventListener('load', ensureScrollable);
        });

        // Enhanced feedback with sound simulation
        // Enhanced feedback with sound simulation
        document.body.addEventListener('scanner:selection', (e) => {
            const item = e.detail.item;
            const feedback = document.getElementById('feedback');

            feedback.textContent = `âœ“ Selected: ${item.label}`;
            feedback.classList.add('show');

            setTimeout(() => {
                feedback.classList.remove('show');
            }, 2000);
        });

        // Smooth scroll for navigation
        document.querySelectorAll('.toc a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Reaction time test (.65 rule)
        const reactionDisplay = document.getElementById('reactionDisplay');
        const reactionStart = document.getElementById('reactionStart');
        const reactionReset = document.getElementById('reactionReset');
        const reactionTrial = document.getElementById('reactionTrial');
        const reactionLast = document.getElementById('reactionLast');
        const reactionAvg = document.getElementById('reactionAvg');
        const reactionRate = document.getElementById('reactionRate');

        const reactionState = {
            trial: 0,
            times: [],
            waiting: false,
            startTime: 0,
            timer: null,
            audioCtx: null
        };

        const updateReactionDisplay = () => {
            reactionTrial.textContent = reactionState.trial;
            const last = reactionState.times[reactionState.times.length - 1];
            reactionLast.textContent = last ? `${last.toFixed(0)} ms` : 'â€”';
            if (reactionState.times.length) {
                const avg = reactionState.times.reduce((a, b) => a + b, 0) / reactionState.times.length;
                reactionAvg.textContent = `${avg.toFixed(0)} ms`;
                const recommended = avg / 0.65;
                reactionRate.textContent = `${recommended.toFixed(0)} ms per item`;
            } else {
                reactionAvg.textContent = 'â€”';
                reactionRate.textContent = 'â€”';
            }
        };

        const playBeep = () => {
            try {
                if (!reactionState.audioCtx) {
                    reactionState.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                const ctx = reactionState.audioCtx;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.value = 880;
                gain.gain.value = 0.08;
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                setTimeout(() => osc.stop(), 120);
            } catch (err) {
                // Audio not available; silent fallback.
            }
        };

        const scheduleCue = () => {
            reactionState.waiting = false;
            reactionDisplay.textContent = 'â³ Wait...';
            const delay = 1000 + Math.random() * 2000;
            reactionState.timer = setTimeout(() => {
                reactionState.timer = null;
                reactionDisplay.textContent = 'ğŸ™‚ Ding!';
                playBeep();
                reactionState.startTime = performance.now();
                reactionState.waiting = true;
            }, delay);
        };

        const startReactionTest = () => {
            if (reactionState.trial >= 3 || reactionState.timer || reactionState.waiting) return;
            reactionState.trial += 1;
            updateReactionDisplay();
            scheduleCue();
        };

        const resetReactionTest = () => {
            reactionState.trial = 0;
            reactionState.times = [];
            reactionState.waiting = false;
            if (reactionState.timer) {
                clearTimeout(reactionState.timer);
            }
            reactionState.timer = null;
            reactionDisplay.textContent = 'ğŸ™‚ Ready?';
            updateReactionDisplay();
        };

        const registerHit = () => {
            if (!reactionState.waiting) return;
            reactionState.waiting = false;
            const now = performance.now();
            const elapsed = now - reactionState.startTime;
            reactionState.times.push(elapsed);
            updateReactionDisplay();
            if (reactionState.trial < 3) {
                scheduleCue();
            } else {
                reactionDisplay.textContent = 'âœ… Done!';
            }
        };

        if (reactionStart) {
            reactionStart.addEventListener('click', startReactionTest);
        }
        if (reactionReset) {
            reactionReset.addEventListener('click', resetReactionTest);
        }

        // Scan time estimator
        const estimateScanRate = document.getElementById('estimateScanRate');
        const estimateGridSize = document.getElementById('estimateGridSize');
        const estimatePattern = document.getElementById('estimatePattern');
        const estimateSwitches = document.getElementById('estimateSwitches');
        const estimatePresses = document.getElementById('estimatePresses');
        const estimateTime = document.getElementById('estimateTime');
        const estimateUseReaction = document.getElementById('estimateUseReaction');
        const estimateReset = document.getElementById('estimateReset');

        const calcAveragePresses = () => {
            const n = Math.max(1, parseInt(estimateGridSize.value, 10) || 1);
            const pattern = estimatePattern.value;
            if (pattern === 'linear') {
                return (n + 1) / 2;
            }
            if (pattern === 'row-column') {
                const rows = Math.ceil(Math.sqrt(n));
                const cols = Math.ceil(n / rows);
                return (rows + 1) / 2 + (cols + 1) / 2;
            }
            const switches = Math.max(2, parseInt(estimateSwitches.value, 10) || 2);
            return Math.max(1, Math.log(n) / Math.log(switches));
        };

        const updateEstimator = () => {
            const rate = Math.max(100, parseInt(estimateScanRate.value, 10) || 1000);
            const presses = calcAveragePresses();
            const timeMs = presses * rate;
            estimatePresses.textContent = `${presses.toFixed(2)} presses`;
            estimateTime.textContent = `${(timeMs / 1000).toFixed(2)} seconds`;
        };

        if (estimateUseReaction) {
            estimateUseReaction.addEventListener('click', () => {
                if (reactionState.times.length) {
                    const avg = reactionState.times.reduce((a, b) => a + b, 0) / reactionState.times.length;
                    estimateScanRate.value = Math.round(avg / 0.65);
                    updateEstimator();
                }
            });
        }

        if (estimateReset) {
            estimateReset.addEventListener('click', () => {
                estimateScanRate.value = 1000;
                estimateGridSize.value = 36;
                estimatePattern.value = 'row-column';
                estimateSwitches.value = 4;
                updateEstimator();
            });
        }

        [estimateScanRate, estimateGridSize, estimatePattern, estimateSwitches].forEach((el) => {
            if (!el) return;
            el.addEventListener('input', updateEstimator);
            el.addEventListener('change', updateEstimator);
        });

        updateEstimator();

        // Settings advisor (Koester & Simpson 2014)
        const advisorRun = document.getElementById('advisorRun');
        const advisorSummary = document.getElementById('advisorSummary');
        const advisorResults = document.getElementById('advisorResults');

        const readAdvisorInput = () => {
            return {
                performanceOk: document.getElementById('advisorPerformance').value === 'yes',
                terCanImprove: document.getElementById('advisorImprove').value === 'yes',
                scanningErrorsPct: parseFloat(document.getElementById('advisorErrors').value || '0'),
                firstPressLate: document.getElementById('advisorFirstLate').checked,
                nextPressLate: document.getElementById('advisorNextLate').checked,
                unintentionalPresses: document.getElementById('advisorUnintentional').checked,
                missingFirstRow: document.getElementById('advisorMissingRow').checked,
                deadTime: document.getElementById('advisorDeadTime').checked,
                inefficientWordPrediction: document.getElementById('advisorWordPred').checked,
                inefficientLayout: document.getElementById('advisorLayout').checked
            };
        };

        const renderAdvisor = () => {
            const advisor = window.ScanSettingsAdvisor;
            if (!advisor || typeof advisor.adviseSettings !== 'function') {
                return;
            }
            const result = advisor.adviseSettings(readAdvisorInput());
            advisorSummary.textContent = result.summary || 'â€”';
            if (!result.recommendations || result.recommendations.length === 0) {
                advisorResults.innerHTML = '<p>No recommendations.</p>';
                return;
            }
            advisorResults.innerHTML = result.recommendations.map((rec) => {
                const actions = rec.actions.map((a) => `<li>${a}</li>`).join('');
                const note = rec.note ? `<p style="margin: 6px 0 0; color: var(--ink-soft);"><em>${rec.note}</em></p>` : '';
                return `
                    <div class="glossary-term">
                        <strong>${rec.category}</strong>
                        <ul style="margin: 8px 0 0; padding-left: 18px;">${actions}</ul>
                        ${note}
                    </div>
                `;
            }).join('');
        };

        if (advisorRun) {
            advisorRun.addEventListener('click', renderAdvisor);
        }

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                const active = document.activeElement;
                if (active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA')) {
                    return;
                }
                if (reactionState.trial > 0) {
                    registerHit();
                }
            }
        });

        document.addEventListener('click', (e) => {
            if (e.target && e.target.id === 'reactionDisplay') {
                registerHit();
            }
        });

        // Glossary auto-linking
        const glossaryTerms = [
            { id: 'glossary-term-acceptance-time', terms: ['acceptance time'] },
            { id: 'glossary-term-auto-scan', terms: ['auto-scan', 'auto scan', 'autoscan'] },
            { id: 'glossary-term-continuous-scan', terms: ['continuous scanning', 'continuous scan'] },
            { id: 'glossary-term-critical-overscan', terms: ['critical overscan'] },
            { id: 'glossary-term-directed-scan', terms: ['directed scanning', 'directed scan'] },
            { id: 'glossary-term-dwell-time', terms: ['dwell time'] },
            { id: 'glossary-term-elimination-scan', terms: ['elimination scanning', 'elimination scan'] },
            { id: 'glossary-term-group-scan', terms: ['group scan', 'group scanning'] },
            { id: 'glossary-term-input-bandwidth', terms: ['input bandwidth'] },
            { id: 'glossary-term-row-column', terms: ['row-column scanning', 'row column scanning', 'row-column', 'row column'] },
            { id: 'glossary-term-scan-rate', terms: ['scan rate'] },
            { id: 'glossary-term-selection-set', terms: ['selection set'] },
            { id: 'glossary-term-step-scan', terms: ['step scan', 'step scanning'] }
        ];

        const escapeRegExp = (value) => value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const skipTags = new Set(['A', 'CODE', 'PRE', 'SCRIPT', 'STYLE', 'TEXTAREA', 'INPUT', 'BUTTON', 'SUMMARY', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6']);

        const linkGlossaryTerms = (root) => {
            const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
                acceptNode: (node) => {
                    if (!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
                    const parent = node.parentElement;
                    if (!parent) return NodeFilter.FILTER_REJECT;
                    if (skipTags.has(parent.tagName)) return NodeFilter.FILTER_REJECT;
                    if (parent.closest('#appendix-glossary')) return NodeFilter.FILTER_REJECT;
                    return NodeFilter.FILTER_ACCEPT;
                }
            });

            const nodes = [];
            while (walker.nextNode()) nodes.push(walker.currentNode);

            nodes.forEach((node) => {
                const text = node.nodeValue;
                let cursor = 0;
                const fragment = document.createDocumentFragment();
                let replaced = false;

                while (cursor < text.length) {
                    let bestMatch = null;
                    glossaryTerms.forEach((entry) => {
                        entry.terms.forEach((term) => {
                            const regex = new RegExp(`\\b${escapeRegExp(term)}\\b`, 'i');
                            const match = regex.exec(text.slice(cursor));
                            if (match) {
                                const index = cursor + match.index;
                                if (!bestMatch || index < bestMatch.index) {
                                    bestMatch = {
                                        index,
                                        length: match[0].length,
                                        text: match[0],
                                        id: entry.id
                                    };
                                }
                            }
                        });
                    });

                    if (!bestMatch) {
                        fragment.appendChild(document.createTextNode(text.slice(cursor)));
                        break;
                    }

                    if (bestMatch.index > cursor) {
                        fragment.appendChild(document.createTextNode(text.slice(cursor, bestMatch.index)));
                    }

                    const link = document.createElement('a');
                    link.href = `#${bestMatch.id}`;
                    link.className = 'glossary-link';
                    link.textContent = bestMatch.text;
                    fragment.appendChild(link);
                    cursor = bestMatch.index + bestMatch.length;
                    replaced = true;
                }

                if (replaced) {
                    node.parentNode.replaceChild(fragment, node);
                }
            });
        };

        linkGlossaryTerms(document.body);

        // Efficiency Calculator - Enhanced
        const ALPHABETICAL = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const FREQUENCY = 'ETAOINSHRDLCUMWFGYPBVKJXQZ';

        function getAlphabet(layout) {
            return layout === 'frequency' ? FREQUENCY : ALPHABETICAL;
        }

        function getLetterCost(letter, gridSize, pattern, layout) {
            const alphabet = getAlphabet(layout);
            const position = alphabet.indexOf(letter.toUpperCase()) + 1;

            if (position === -1) return 0; // Space or unknown character

            const sqrt = Math.sqrt(gridSize);
            const rows = Math.ceil(sqrt);
            const cols = Math.ceil(gridSize / rows);

            switch (pattern) {
                case 'linear':
                    return position;

                case 'row-column':
                    const targetRow = Math.ceil(position / cols);
                    const targetCol = ((position - 1) % cols) + 1;
                    return targetRow + targetCol;

                case 'elimination':
                    return Math.ceil(Math.log(gridSize) / Math.log(4));

                default:
                    return position;
            }
        }

        function calculateSentenceCost() {
            const sentence = document.getElementById('sentenceInput').value.toUpperCase();
            const gridSize = parseInt(document.getElementById('calcGridSize').value);
            const pattern = document.getElementById('calcPattern').value;
            const layout = document.getElementById('alphabetLayout').value;

            let totalCost = 0;
            let letterCosts = [];

            for (let letter of sentence) {
                const cost = getLetterCost(letter, gridSize, pattern, layout);
                totalCost += cost;
                letterCosts.push({ letter, cost });
            }

            // Display results
            const avgCost = totalCost / sentence.length;
            const totalTime = (totalCost * 1.0).toFixed(1); // At 1000ms scan rate

            let letterBreakdown = letterCosts.map(lc => {
                const bgColor = lc.cost > 10 ? '#ffcdd2' : lc.cost > 6 ? '#ffe0b2' : '#c8e6c9';
                return `<span style="display: inline-block; padding: 2px 6px; margin: 2px; background: ${bgColor}; border-radius: 4px; font-weight: bold;">
                    ${lc.letter === ' ' ? 'â£' : lc.letter}<span style="font-size: 0.8em; color: #666;">(${lc.cost})</span>
                </span>`;
            }).join('');

            const resultHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="margin-top: 0;">ğŸ“Š Cost Breakdown</h4>
                        <p><strong>Total Switch Presses:</strong> ${totalCost}</p>
                        <p><strong>Average per Letter:</strong> ${avgCost.toFixed(1)} presses</p>
                        <p><strong>Time (at 1000ms):</strong> ${totalTime} seconds</p>
                        <p><strong>Letters:</strong> ${sentence.length}</p>
                    </div>
                    <div>
                        <h4 style="margin-top: 0;">ğŸ¨ Color Legend</h4>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="padding: 4px 8px; background: #c8e6c9; border-radius: 4px;">Low cost (1-6)</span>
                            <span style="padding: 4px 8px; background: #ffe0b2; border-radius: 4px;">Medium cost (7-10)</span>
                            <span style="padding: 4px 8px; background: #ffcdd2; border-radius: 4px;">High cost (11+)</span>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4>ğŸ”¤ Letter-by-Letter Breakdown:</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px; line-height: 2;">
                        ${letterBreakdown}
                    </div>
                </div>

                <div class="highlight-box" style="margin-top: 15px; background: #e8f5e9; border-left-color: #4CAF50;">
                    <strong>ğŸ’¡ Tip:</strong> Switch to <em>Frequency</em> layout and <em>Elimination</em> pattern for best results!
                    Try the same sentence with different settings to compare.
                </div>
            `;

            document.getElementById('sentenceResult').innerHTML = resultHTML;
        }

        function updateCalculator() {
            const layout = document.getElementById('alphabetLayout').value;
            const gridSize = document.getElementById('calcGridSize').value;
            const pattern = document.getElementById('calcPattern').value;
            const viewMode = document.getElementById('calcViewMode').value;

            // Update the scanner
            const scanner = document.getElementById('calcScanner');
            if (scanner) {
                scanner.setAttribute('grid-size', gridSize);
                scanner.setAttribute('scan-pattern', pattern);
                scanner.setAttribute('layout-mode', layout);
                scanner.setAttribute('view-mode', viewMode);
            }

            // Recalculate sentence if there's input
            const sentenceInput = document.getElementById('sentenceInput');
            if (sentenceInput && sentenceInput.value) {
                calculateSentenceCost();
            }
        }

        // Old calculator (kept for backward compatibility)
        window.calculateEfficiency = calculateSentenceCost;

        // Quick sentence examples
        function trySentence(sentence) {
            document.getElementById('sentenceInput').value = sentence;
            calculateSentenceCost();

            // Scroll to result
            document.getElementById('sentenceResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Add navigation buttons to each section
        const chapters = document.querySelectorAll('section');
        const chapterTitles = [
            'What is a Switch?',
            'The Bandwidth Problem',
            'Cause & Effect',
            'Selection Sets',
            'Single Switch Scanning',
            'Two Switch Scanning',
            'Why Group?',
            'Row-Column Scanning',
            'Progressive Segmenting & Elimination',
            'Pattern Comparison',
            'Efficiency Calculator',
            'Patterns & Modes Hub',
            'Timing & Optimization (.65 Rule)',
            'Visualization Options',
            'Block vs Point',
            'Continuous Scanning',
            'Critical Overscan',
            'Directed Scanning',
            'Error Recovery',
            'Feedback & Highlighting',
            'User Profiles',
            'Implementing Scanners',
            'Accessibility Testing',
            'Design Patterns',
            'Appendix: Glossary'
        ];

        chapters.forEach((chapter, index) => {
            const nav = document.createElement('div');
            nav.className = 'chapter-nav';

            // Previous button
            if (index > 0) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'prev-btn';
                prevBtn.innerHTML = 'â† ' + chapterTitles[index - 1];
                prevBtn.onclick = () => {
                    chapters[index - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                };
                nav.appendChild(prevBtn);
            } else {
                const spacer = document.createElement('div');
                nav.appendChild(spacer);
            }

            // Next button
            if (index < chapters.length - 1) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'next-btn';
                nextBtn.innerHTML = chapterTitles[index + 1] + ' â†’';
                nextBtn.onclick = () => {
                    chapters[index + 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                };
                nav.appendChild(nextBtn);
            }

            chapter.appendChild(nav);
        });

        // Progress bar
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progressBar').style.width = scrolled + '%';
        });

        // Back to top button
        const backToTop = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>

</body>
</html>
