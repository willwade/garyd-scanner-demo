<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch Scanning: The Interactive Book</title>
    <!-- Don't import main.css - it has overflow:hidden that breaks scrolling -->
    <!-- <link rel="stylesheet" href="./src/style.css"> -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <style>
        /* Override everything - ensure scrolling works! */
        html, body {
            overflow-x: hidden !important;
            overflow-y: auto !important;
            height: auto !important;
            min-height: 100% !important;
            max-height: none !important;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Patrick Hand', sans-serif;
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px 100px 20px;
            background: #fffdf9;
            color: #333;
            display: block;
            position: relative;
        }

        h1, h2, h3 {
            font-weight: normal;
            margin-top: 40px;
        }

        h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 2rem;
            color: #34495e;
        }

        section {
            margin-bottom: 80px;
            padding: 30px;
            border: 2px dashed #bdc3c7;
            border-radius: 15px;
            background: white;
            box-shadow: 5px 5px 0px rgba(52, 152, 219, 0.1);
            page-break-inside: avoid;
        }

        .scanner-container {
            min-height: 250px;
            max-height: 60vh;
            margin: 20px 0;
            border: 2px solid #3498db;
            border-radius: 8px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .scanner-container.small {
            min-height: 180px;
            max-height: 40vh;
        }

        .scanner-container.large {
            min-height: 300px;
            max-height: 70vh;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            body {
                padding: 20px 15px 80px 15px;
            }

            h1 {
                font-size: 1.8rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            section {
                padding: 20px 15px;
                margin-bottom: 60px;
            }

            .scanner-container {
                height: 300px;
                max-height: 50vh;
            }

            .scanner-container.small {
                height: 180px;
            }

            .scanner-container.large {
                height: 350px;
                max-height: 60vh;
            }

            .chapter-nav button {
                padding: 10px 16px;
                font-size: 0.95rem;
            }

            /* Stack the comparison grids on mobile */
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
        }

        .demo-box {
            background: #eef5fb;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .demo-title {
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 10px;
        }

        .demo-instructions {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 10px 0;
            font-size: 0.95em;
        }

        .key-badge {
            display: inline-block;
            background: #34495e;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-family: monospace;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background: #3498db;
            color: white;
        }

        .comparison-table tr:nth-child(even) {
            background: #f2f2f2;
        }

        .highlight-box {
            background: #d5f4e6;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 15px 0;
        }

        .warning-box {
            background: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 15px;
            margin: 15px 0;
        }

        .info-box {
            background: #74b9ff;
            border-left: 4px solid #0984e3;
            padding: 15px;
            margin: 15px 0;
            color: white;
        }

        #feedback {
            position: fixed;
            bottom: 20px;
            right: 20px;
            left: 20px;
            max-width: calc(100% - 40px);
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            text-align: center;
        }

        #feedback.show {
            opacity: 1;
        }

        .toc {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: #2980b9;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .diagram {
            background: white;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        code {
            background: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        pre code {
            background: transparent;
            padding: 0;
        }

        .chapter-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .chapter-nav button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-family: 'Patrick Hand', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chapter-nav button:hover {
            background: #2980b9;
        }

        .chapter-nav button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .chapter-nav .prev-btn {
            margin-right: auto;
        }

        .chapter-nav .next-btn {
            margin-left: auto;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: #3498db;
            width: 0%;
            transition: width 0.3s;
            z-index: 1000;
        }

        .back-to-top {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: #34495e;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 999;
        }

        @media (max-width: 768px) {
            .back-to-top {
                bottom: 70px;
                left: 15px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
        }

        .back-to-top:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .back-to-top.show {
            display: flex;
        }

        /* Ensure web component doesn't cause overflow */
        switch-scanner {
            display: block;
            width: 100%;
            height: 100%;
        }

        switch-scanner::part(wrapper) {
            height: 100%;
            overflow: hidden;
        }

        /* Mermaid Diagram Sketch Theme */
        .mermaid {
            font-family: 'Patrick Hand', sans-serif !important;
            background: white;
            padding: 20px;
            border: 2px dashed #bdc3c7;
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            margin: 20px 0;
            overflow-x: auto;
        }

        /* Override mermaid SVG styles for sketch look */
        .mermaid svg {
            font-family: 'Patrick Hand', cursive !important;
        }

        .mermaid .node rect,
        .mermaid .node circle,
        .mermaid .node ellipse,
        .mermaid .node polygon,
        .mermaid .node path {
            stroke-width: 2px !important;
            stroke: #333 !important;
            stroke-dasharray: 1000;
            stroke-dashoffset: 0;
            animation: none !important;
        }

        .mermaid .node .label {
            font-family: 'Patrick Hand', cursive !important;
            font-size: 16px !important;
            color: #333 !important;
        }

        .mermaid .edgePath .path {
            stroke-width: 2px !important;
            stroke: #333 !important;
            stroke-dasharray: 5, 5 !important; /* Dashed lines for sketchy look */
        }

        .mermaid .edgeLabel {
            font-family: 'Patrick Hand', cursive !important;
            background-color: white !important;
            padding: 5px 10px !important;
            border: 2px dashed #333 !important;
            border-radius: 10px !important;
        }

        .mermaid .cluster rect {
            stroke: #3498db !important;
            stroke-width: 2px !important;
            stroke-dasharray: 5, 5 !important;
            fill: rgba(52, 152, 219, 0.05) !important;
        }
    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    <button class="back-to-top" id="backToTop" title="Back to top">â†‘</button>

    <h1>ğŸ¯ Switch Scanning: The Interactive Book</h1>
    <p><strong>An interactive exploration of switch access technology for developers, UX designers, clinicians, and occupational therapists.</strong></p>

    <div class="toc">
        <h3>Table of Contents</h3>
        <ul>
            <li><a href="#chapter-1">1. What is a Switch?</a></li>
            <li><a href="#chapter-2">2. The Bandwidth Problem</a></li>
            <li><a href="#chapter-3">3. Cause & Effect</a></li>
            <li><a href="#chapter-4">4. Selection Sets</a></li>
            <li><a href="#chapter-5">5. Single Switch Scanning</a></li>
            <li><a href="#chapter-6">6. Two Switch Scanning</a></li>
            <li><a href="#chapter-7">7. Why Group?</a></li>
            <li><a href="#chapter-8">8. Row-Column Scanning</a></li>
            <li><a href="#chapter-9">9. Elimination Scanning</a></li>
            <li><a href="#chapter-10">10. Pattern Comparison âš¡</a></li>
            <li><a href="#chapter-11">11. Efficiency Calculator ğŸ“Š</a></li>
            <li><a href="#chapter-12">12. Timing & Optimization â±ï¸</a></li>
            <li><a href="#chapter-13">13. Visualization Options ğŸ¨</a></li>
            <li><a href="#chapter-14">14. Block vs Point Technique ğŸ‘ï¸</a></li>
        </ul>
    </div>

    <!-- Chapter 1 -->
    <section id="chapter-1">
        <h2>Chapter 1: What is a Switch?</h2>

        <p>A <strong>switch</strong> is an assistive technology device that provides a simple binary input: <strong>ON</strong> or <strong>OFF</strong>. Unlike a keyboard with many keys or a mouse with X/Y coordinates, a switch is the simplest possible input mechanism.</p>

        <h3>Physical Switch Types</h3>

        <ul>
            <li><strong>Button Switches</strong> - Large or small buttons activated with any body part</li>
            <li><strong>Joystick Switches</strong> - Directional switches activated by tilting</li>
            <li><strong>Pressure Pads</strong> - Activated by leaning or pressing</li>
            <li><strong>Puff/Sip Switches</strong> - Controlled by breath through a tube</li>
            <li><strong>Muscle Sensors</strong> - Detect muscle contraction (e.g., eyebrow raise)</li>
            <li><strong>Beam Switches</strong> - Broken by hand movement through infrared beam</li>
        </ul>

        <div class="highlight-box">
            <strong>ğŸ’¡ Key Insight:</strong> For people with severe physical disabilities, a switch may be the ONLY reliable voluntary movement they can perform. Scanning transforms this single binary input into full access to technology.
        </div>
    </section>

    <!-- Chapter 2 -->
    <section id="chapter-2">
        <h2>Chapter 2: The Bandwidth Problem</h2>

        <p><strong>Input Bandwidth</strong> refers to the amount of information a user can transmit per unit of time.</p>

        <table class="comparison-table">
            <tr>
                <th>Input Type</th>
                <th>Bandwidth</th>
                <th>Speed</th>
            </tr>
            <tr>
                <td>Touch Typist</td>
                <td>High (10+ fingers)</td>
                <td>~100 words/minute</td>
            </tr>
            <tr>
                <td>Hunt & Peck</td>
                <td>Medium (1-2 fingers)</td>
                <td>~20 words/minute</td>
            </tr>
            <tr>
                <td>Switch User</td>
                <td>Low (1 binary input)</td>
                <td>~5-15 words/minute</td>
            </tr>
        </table>

        <h3>The Sushi Bar Analogy</h3>

        <p>Imagine a sushi bar where dishes rotate past you on a conveyor belt. You cannot reach everything at onceâ€”you must wait for the dish you want to come to you, then grab it quickly.</p>

        <div class="info-box">
            <strong>Switch users trade TIME for ACCESS.</strong><br>
            They don't have instant access to any item like a mouse user. They must wait for the scan to reach the item they want, then activate their switch at precisely the right moment.
        </div>

        <div class="diagram">
            <pre style="background: white; color: #333;">
High Bandwidth     â”‚  Low Bandwidth
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Touch Typist       â”‚  Switch User
(10+ fingers)      â”‚  (1 bit: ON/OFF)
     â”‚                    â”‚
     â–¼                    â–¼
Full Keyboard       â”‚  Scanning Interface
100+ keys           â”‚  (Access via timing)
     â”‚                    â”‚
     â–¼                    â–¼
Fast Typing         â”‚  Full Access
~100 wpm            â”‚  ~5-15 wpm
            </pre>
        </div>
    </section>

    <!-- Chapter 3 -->
    <section id="chapter-3">
        <h2>Chapter 3: Cause & Effect</h2>

        <p>Before scanning, users must understand <strong>Cause and Effect</strong>: "When I activate my switch, something happens."</p>

        <p>This is the foundation of all switch use. Without understanding this connection, scanning makes no sense.</p>

        <h3>Interactive Demo 1: Simple Cause & Effect</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Press <span class="key-badge">Space</span> or click "Select" to play music!
        </div>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-mode="cause-effect"
                grid-cols="1"
                custom-items='[{"label":"ğŸµ Play Music!", "image":"https://api.iconify.design/twemoji:musical-note.svg", "id":"play"}]'>
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>What's happening:</strong>
            <ul>
                <li>Only 1 item available</li>
                <li>Switch press ALWAYS triggers it</li>
                <li>User learns: My press â†’ Effect happens</li>
                <li>Builds confidence and understanding</li>
            </ul>
        </div>

        <h3>The Learning Progression</h3>

        <ol>
            <li><strong>Random Activation</strong> - User accidentally activates switch, notices something happens</li>
            <li><strong>Intentional Activation</strong> - User purposefully activates switch to see effect</li>
            <li><strong>Timed Activation</strong> - User learns to activate at specific moments</li>
            <li><strong>Controlled Activation</strong> - User activates to select specific items (scanning!)</li>
        </ol>
    </section>

    <!-- Chapter 4 -->
    <section id="chapter-4">
        <h2>Chapter 4: Selection Sets</h2>

        <p>A <strong>Selection Set</strong> is all the items available for the user to choose from at any given time.</p>

        <h3>Presentation Formats</h3>

        <h4>1. Single Line Presentation</h4>
        <p>Items arranged in a single row (horizontal or vertical)</p>
        <p><strong>Best for:</strong> Small sets (&lt;10 items), simple choices</p>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Linear scan of 4 colors
        </div>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-technique="point"
                scan-rate="1500"
                grid-cols="4"
                custom-items='[
                    {"label":"Red", "backgroundColor":"#ffcccc", "id":"red"},
                    {"label":"Blue", "backgroundColor":"#ccccff", "id":"blue"},
                    {"label":"Green", "backgroundColor":"#ccffcc", "id":"green"},
                    {"label":"Yellow", "backgroundColor":"#ffffcc", "id":"yellow"}
                ]'>
            </switch-scanner>
        </div>

        <h4>2. Grid Presentation</h4>
        <p>Items arranged in a 2D grid</p>
        <p><strong>Best for:</strong> Large sets, organized layouts</p>

        <div class="demo-instructions">
            ğŸ® <strong>Compare:</strong> Try selecting number 59 in each grid below. Notice how much longer the 64-item grid takes!
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h5>16 Items (4Ã—4)</h5>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-technique="point"
                        scan-rate="800"
                        grid-size="16">
                    </switch-scanner>
                </div>
            </div>
            <div>
                <h5>64 Items (8Ã—8)</h5>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-technique="point"
                        scan-rate="800"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>
        </div>

        <div class="warning-box">
            <strong>âš ï¸ The Problem:</strong> Linear scanning of large sets is painfully slow!<br>
            â€¢ 16 items: Average cost = 8 presses<br>
            â€¢ 64 items: Average cost = 32 presses!<br>
            â€¢ 100 items: Average cost = 50 presses ğŸ˜±<br><br>
            <strong>Solution:</strong> <a href="#chapter-7">Grouping</a> (Chapter 7) dramatically reduces scan time.
        </div>
    </section>

    <!-- Chapter 5 -->
    <section id="chapter-5">
        <h2>Chapter 5: Single Switch Scanning</h2>

        <p><strong>Single Switch Scanning (Auto-Scan)</strong> is the most common scanning method.</p>

        <h3>How it works:</h3>
        <ol>
            <li>System automatically highlights items in sequence</li>
            <li>User waits for desired item to be highlighted</li>
            <li>User presses switch to select</li>
            <li>System activates item and restarts scan</li>
        </ol>

        <div class="demo-instructions">
            ğŸ® <strong>Challenge:</strong> Can you select the number 7?<br>
            Press <span class="key-badge">Space</span> when 7 is highlighted!
        </div>

        <div class="scanner-container">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-technique="point"
                scan-rate="1000"
                grid-size="9">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>ğŸ’¡ Timing Tips:</strong>
            <ul>
                <li><strong>Too fast</strong> = User misses items, can't react in time</li>
                <li><strong>Too slow</strong> = Frustrating, takes too long</li>
                <li><strong>Just right</strong> = User feels in control, not rushed</li>
            </ul>
        </div>

        <h3>The Auto-Scan Flow</h3>

        <div class="diagram">
            <pre style="background: white; color: #333;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Start Scan  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Highlight Item 1 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Switch  â”‚â—„â”€â”€â”€â”€ No â”€â”€â”€â”€â”
   â”‚Pressed? â”‚              â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚
        â”‚ Yes               â”‚
        â–¼                   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
   â”‚ Select  â”‚         â”‚ Wait Scan â”‚
   â”‚  Item   â”‚         â”‚   Rate    â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚
        â–¼                   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Restart  â”‚â—„â”€â”‚Highlight Next Itemâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
        </div>
    </section>

    <!-- Chapter 6 -->
    <section id="chapter-6">
        <h2>Chapter 6: Two Switch Scanning</h2>

        <p><strong>Two Switch Scanning (Step Scan)</strong> gives the user more control over timing.</p>

        <h3>How it works:</h3>
        <ul>
            <li><strong>Switch 1 (Advance)</strong>: Move to next item - Key <span class="key-badge">2</span></li>
            <li><strong>Switch 2 (Select)</strong>: Choose current item - Key <span class="key-badge">Space</span></li>
        </ul>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Use <span class="key-badge">Key '2'</span> to move, <span class="key-badge">Space</span> to select!<br>
            Notice: No time pressure! Move at your own pace.
        </div>

        <div class="scanner-container">
            <switch-scanner
                theme="sketch"
                scan-input-mode="manual"
                scan-pattern="linear"
                scan-technique="point"
                grid-size="9"
                custom-items='[
                    {"label":"ğŸ Apple", "id":"apple"},
                    {"label":"ğŸŒ Banana", "id":"banana"},
                    {"label":"ğŸ‡ Grapes", "id":"grapes"},
                    {"label":"ğŸŠ Orange", "id":"orange"},
                    {"label":"ğŸ“ Strawberry", "id":"strawberry"},
                    {"label":"ğŸ‰ Watermelon", "id":"watermelon"},
                    {"label":"ğŸ‘ Peach", "id":"peach"},
                    {"label":"ğŸ’ Cherry", "id":"cherry"},
                    {"label":"ğŸ‹ Lemon", "id":"lemon"}
                ]'>
            </switch-scanner>
        </div>

        <h3>Comparison: Auto-Scan vs Step Scan</h3>

        <table class="comparison-table">
            <tr>
                <th>Feature</th>
                <th>Auto-Scan (1 Switch)</th>
                <th>Step Scan (2 Switches)</th>
            </tr>
            <tr>
                <td>Timing control</td>
                <td>System controls</td>
                <td>User controls âœ“</td>
            </tr>
            <tr>
                <td>Cognitive load</td>
                <td>Must watch timing</td>
                <td>No timing pressure âœ“</td>
            </tr>
            <tr>
                <td>Physical effort</td>
                <td>1 switch âœ“</td>
                <td>2 switches</td>
            </tr>
            <tr>
                <td>Speed</td>
                <td>Fixed</td>
                <td>Variable (user-paced) âœ“</td>
            </tr>
            <tr>
                <td>Best for</td>
                <td>Single switch users âœ“</td>
                <td>Users with good motor control âœ“</td>
            </tr>
        </table>
    </section>

    <!-- Chapter 7 -->
    <section id="chapter-7">
        <h2>Chapter 7: Why Group?</h2>

        <p><strong>The Problem:</strong> Linear scanning of large sets is painfully slow.</p>

        <h3>Scan Cost Calculation</h3>

        <p>For <strong>N</strong> items in linear scan:</p>
        <ul>
            <li>Average cost to select any item = <strong>N/2</strong></li>
            <li>Cost to select last item = <strong>N</strong></li>
        </ul>

        <h3>Example: 36 Items (6Ã—6 grid)</h3>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: #ffeaa7; padding: 15px; border-radius: 8px;">
                <h4>âŒ Linear Scan</h4>
                <p>Scan all 36 items one by one</p>
                <p><strong>Average cost: 18 presses</strong></p>
                <p><strong>Max cost: 36 presses</strong></p>
            </div>
            <div style="background: #d5f4e6; padding: 15px; border-radius: 8px;">
                <h4>âœ“ Row-Column Scan</h4>
                <p>Stage 1: Scan 6 rows (6 options)</p>
                <p>Stage 2: Scan 6 items in row (6 options)</p>
                <p><strong>Average cost: 9 presses</strong></p>
                <p><strong>Max cost: 12 presses</strong></p>
            </div>
        </div>

        <div class="highlight-box">
            <strong>ğŸ‰ That's 50% faster!</strong><br><br>
            By grouping items into rows, we dramatically reduce the scan cost.<br>
            This is the power of hierarchical scanning!
        </div>

        <h3>Hierarchy Visualization</h3>

        <div class="diagram">
            <pre style="background: white; color: #333;">
         Entire Selection Set (36 items)
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â”‚    â”‚    â”‚   â”‚
      Row1 Row2 Row3 Row4 Row5 Row6
       â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
      6    6    6    6    6    6
    items items items items items items
            </pre>
        </div>

        <p>Instead of 36 individual choices, we have:</p>
        <ol>
            <li><strong>First choice:</strong> Which row? (6 options)</li>
            <li><strong>Second choice:</strong> Which item in row? (6 options)</li>
        </ol>
    </section>

    <!-- Chapter 8 -->
    <section id="chapter-8">
        <h2>Chapter 8: Row-Column Scanning</h2>

        <p><strong>Row-Column Scanning</strong> is the most common grouped scanning method.</p>

        <h3>How It Works</h3>

        <p><strong>Stage 1: Row Selection</strong><br>
        System highlights each ROW. User selects desired row.</p>

        <p><strong>Stage 2: Item Selection</strong><br>
        System highlights items within selected ROW. User selects desired item.</p>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Watch the rows scan first, then items within the row!
        </div>

        <div class="scanner-container">
            <switch-scanner
                theme="sketch"
                scan-pattern="row-column"
                scan-technique="block"
                scan-rate="1000"
                grid-size="16">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>Observe:</strong>
            <ol>
                <li><strong>First pass:</strong> Rows highlight (entire rows light up)</li>
                <li><strong>Select a row:</strong> Now items within that row scan</li>
                <li><strong>Select item:</strong> Item activates, scan restarts</li>
            </ol>
        </div>

        <h3>Block vs Point Technique</h3>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>Block Technique</h4>
                <p>Highlights ENTIRE row as solid block</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="block"
                        scan-rate="1500"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Easier to see, better for larger items</p>
            </div>
            <div>
                <h4>Point Technique</h4>
                <p>Highlights just the row indicator</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="point"
                        scan-rate="1500"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Less visual clutter, better for dense grids</p>
            </div>
        </div>
    </section>

    <!-- Chapter 9 -->
    <section id="chapter-9">
        <h2>Chapter 9: Elimination Scanning</h2>

        <p><strong>Elimination Scanning</strong> is the fastest scanning method for large grids.</p>

        <h3>How It Works</h3>

        <p>Instead of scanning items or rows, we <strong>eliminate</strong> portions of the grid.</p>

        <p><strong>Example: 4-Switch Elimination (Quadrant Scanning)</strong> of 64 items:</p>

        <ol>
            <li><strong>Stage 1:</strong> Split grid into 4 quadrants â†’ User selects quadrant (now 16 items)</li>
            <li><strong>Stage 2:</strong> Split quadrant into 4 sub-quadrants â†’ User selects sub-quadrant (now 4 items)</li>
            <li><strong>Stage 3:</strong> Individual items â†’ User selects item</li>
        </ol>

        <p><strong>Maximum cost: 3 selections!</strong> (Compared to 64 for linear scan)</p>

        <h3>Efficiency Comparison for 64 Items</h3>

        <table class="comparison-table">
            <tr>
                <th>Method</th>
                <th>Max Presses</th>
                <th>Average Presses</th>
                <th>Speed</th>
            </tr>
            <tr>
                <td>Linear</td>
                <td>64</td>
                <td>32</td>
                <td>Slow ğŸ˜´</td>
            </tr>
            <tr>
                <td>Row-Column (8Ã—8)</td>
                <td>16</td>
                <td>9</td>
                <td>Medium</td>
            </tr>
            <tr>
                <td>Elimination (4-switch)</td>
                <td><strong>3</strong></td>
                <td><strong>3</strong></td>
                <td><strong>Fast! ğŸš€</strong></td>
            </tr>
        </table>

        <div class="demo-instructions">
            ğŸ® <strong>Experience the speed!</strong><br>
            1. First scan: Grid splits into 4 colored quadrants<br>
            2. Select a quadrant: It splits into 4 sub-quadrants<br>
            3. Select sub-quadrant: Individual items appear<br>
            4. Select item: Done! Just 3 presses max!
        </div>

        <div class="scanner-container large">
            <switch-scanner
                theme="sketch"
                scan-pattern="elimination"
                elimination-switch-count="4"
                scan-rate="1500"
                grid-size="64">
            </switch-scanner>
        </div>

        <div class="info-box">
            <strong>ğŸ¯ Advanced:</strong> Elimination scanning supports 2-8 switches!<br>
            â€¢ 2 switches (binary) - Slowest, simplest<br>
            â€¢ 3 switches - Good balance<br>
            â€¢ 4 switches (quadrant) - <strong>Most common</strong><br>
            â€¢ 5-8 switches - Fastest, most complex
        </div>
    </section>

    <!-- Chapter 10 -->
    <section id="chapter-10">
        <h2>Chapter 10: Pattern Comparison - Which is Fastest?</h2>

        <p>Different scanning patterns have dramatically different efficiency. Let's compare them directly!</p>

        <h3>Visualizing the Patterns</h3>

        <p>Here's how each scanning pattern works, visualized as flowcharts:</p>

        <h4>Linear Scanning Flow</h4>
        <pre class="mermaid">
%%{init: {'theme':'base', 'themeVariables': { 'primaryColor': '#fff', 'primaryTextColor': '#333', 'primaryBorderColor': '#333', 'lineColor': '#333', 'fontFamily': 'Patrick Hand' }}}%%
flowchart TD
    A[Start Scan] --> B[Highlight Item 1]
    B --> C{Switch Press?}
    C -->|No| D[Highlight Item 2]
    D --> E{Switch Press?}
    E -->|No| F[Highlight Item 3]
    F --> G{Switch Press?}
    G -->|No| H[Continue...]
    H --> I{Switch Press?}
    I -->|Yes| J["âœ“ SELECT"]
    I -->|No| K[Loop to Start]
    C -->|Yes| J
    E -->|Yes| J
    G -->|Yes| J

    classDef successStyle fill:#4CAF50,stroke:#333,stroke-width:3px
    classDef startStyle fill:#3498db,stroke:#333,stroke-width:2px
    classDef decisionStyle fill:#FF9800,stroke:#333,stroke-width:2px

    class J successStyle
    class A startStyle
    class C,E,G,I decisionStyle
        </pre>

        <h4>Row-Column Scanning Flow</h4>
        <pre class="mermaid">
%%{init: {'theme':'base', 'themeVariables': { 'primaryColor': '#fff', 'primaryTextColor': '#333', 'primaryBorderColor': '#333', 'lineColor': '#333', 'fontFamily': 'Patrick Hand' }}}%%
flowchart TD
    A[Start Scan] --> B[Highlight Row 1]
    B --> C{Switch Press?}
    C -->|No| D[Highlight Row 2]
    D --> E{Switch Press?}
    E -->|No| F[Highlight Row 3]
    F --> G{Switch Press?}
    G -->|Yes Row| H[Enter Row 1]
    H --> I[Highlight Item 1.1]
    I --> J{Switch Press?}
    J -->|No| K[Highlight Item 1.2]
    K --> L{Switch Press?}
    L -->|Yes Item| M["âœ“ SELECT"]
    C -->|Yes Row| H
    E -->|Yes Row| H
    G -->|Yes Row| H

    classDef successStyle fill:#4CAF50,stroke:#333,stroke-width:3px
    classDef startStyle fill:#3498db,stroke:#333,stroke-width:2px
    classDef processStyle fill:#FF9800,stroke:#333,stroke-width:2px
    classDef decisionStyle fill:#fff,stroke:#333,stroke-width:2px

    class M successStyle
    class A startStyle
    class H processStyle
    class C,E,G,I,J,K,L decisionStyle
        </pre>

        <h4>Elimination Scanning Flow (4-switch)</h4>
        <pre class="mermaid">
%%{init: {'theme':'base', 'themeVariables': { 'primaryColor': '#fff', 'primaryTextColor': '#333', 'primaryBorderColor': '#333', 'lineColor': '#333', 'fontFamily': 'Patrick Hand' }}}%%
flowchart TD
    A[Start Scan] --> B[Highlight Top-Left Quadrant]
    B --> C{Switch Press?}
    C -->|No| D[Highlight Top-Right]
    D --> E{Switch Press?}
    E -->|No| F[Highlight Bottom-Left]
    F --> G{Switch Press?}
    G -->|No| H[Highlight Bottom-Right]
    H --> I{Items Remain?}
    I -->|Yes| J[Recurse into Selected]
    J --> K{Switch Press?}
    K -->|Yes| L["âœ“ SELECT"]
    C -->|Yes| L
    E -->|Yes| L
    G -->|Yes| L

    classDef successStyle fill:#4CAF50,stroke:#333,stroke-width:3px
    classDef startStyle fill:#3498db,stroke:#333,stroke-width:2px
    classDef processStyle fill:#FF9800,stroke:#333,stroke-width:2px
    classDef decisionStyle fill:#fff,stroke:#333,stroke-width:2px

    class L successStyle
    class A startStyle
    class J processStyle
    class C,E,G,K,I decisionStyle
        </pre>

        <h3>Interactive Comparison: Small Grid (16 items)</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Challenge:</strong> Time yourself selecting the number 15 with each pattern below.<br>
            Compare how long it takes and how many presses you need!
        </div>

        <h4>Pattern A: Linear Scan</h4>
        <p><strong>Theory:</strong> Scans all 16 items one by one</p>
        <p><strong>Max cost:</strong> 16 presses | <strong>Average:</strong> 8 presses</p>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                scan-technique="point"
                scan-rate="800"
                grid-size="16">
            </switch-scanner>
        </div>

        <h4>Pattern B: Row-Column Scan</h4>
        <p><strong>Theory:</strong> Scans 4 rows, then 4 items in selected row</p>
        <p><strong>Max cost:</strong> 8 presses | <strong>Average:</strong> 5 presses</p>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="row-column"
                scan-technique="block"
                scan-rate="800"
                grid-size="16">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>ğŸ“Š Result:</strong> Row-Column is about <strong>37.5% faster</strong> than Linear for 16 items!<br>
            Linear: 8 presses average | Row-Column: 5 presses average
        </div>

        <h3>Interactive Comparison: Large Grid (64 items)</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Challenge:</strong> Try selecting number 63 with each pattern.<br>
            Notice the dramatic difference!
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div>
                <h4>Linear Scan (ğŸ˜´)</h4>
                <p style="font-size: 0.9em;"><strong>Max:</strong> 64 presses<br><strong>Avg:</strong> 32 presses</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-technique="point"
                        scan-rate="600"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>

            <div>
                <h4>Row-Column (ğŸ™‚)</h4>
                <p style="font-size: 0.9em;"><strong>Max:</strong> 16 presses<br><strong>Avg:</strong> 9 presses</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="block"
                        scan-rate="600"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>

            <div>
                <h4>Elimination (ğŸš€)</h4>
                <p style="font-size: 0.9em;"><strong>Max:</strong> 3 presses<br><strong>Avg:</strong> 3 presses</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="elimination"
                        elimination-switch-count="4"
                        scan-rate="1000"
                        grid-size="64">
                    </switch-scanner>
                </div>
            </div>
        </div>

        <div class="info-box">
            <strong>ğŸ¤¯ Mind-blowing efficiency:</strong><br>
            â€¢ Linear: 32 presses average<br>
            â€¢ Row-Column: 9 presses average (72% faster!)<br>
            â€¢ Elimination: 3 presses average (91% faster!)<br><br>
            For a switch user, this means the difference between waiting 32 seconds vs 3 seconds to make a selection!
        </div>

        <h3>Pattern Selection Guide</h3>

        <table class="comparison-table">
            <tr>
                <th>Grid Size</th>
                <th>Recommended Pattern</th>
                <th>Why</th>
            </tr>
            <tr>
                <td>1-10 items</td>
                <td>Linear</td>
                <td>Simple, fast enough</td>
            </tr>
            <tr>
                <td>11-30 items</td>
                <td>Row-Column</td>
                <td>Good balance of speed and complexity</td>
            </tr>
            <tr>
                <td>31-100 items</td>
                <td>Row-Column OR Elimination</td>
                <td>Depends on user ability</td>
            </tr>
            <tr>
                <td>100+ items</td>
                <td>Elimination</td>
                <td>Only viable option for large grids</td>
            </tr>
        </table>

        <h3>Efficiency Comparison Chart</h3>
        <p>Here's a visual comparison of how many switch presses each pattern requires for different grid sizes:</p>

        <pre class="mermaid">
%%{init: {'theme':'base', 'themeVariables': { 'primaryColor': '#fff', 'primaryTextColor': '#333', 'primaryBorderColor': '#333', 'lineColor': '#333', 'fontFamily': 'Patrick Hand' }}}%%
flowchart LR
    subgraph GridSizes["Grid Sizes"]
        direction TB
        N16["16 items<br/>(4Ã—4)"]
        N64["64 items<br/>(8Ã—8)"]
        N100["100 items<br/>(10Ã—10)"]
    end

    subgraph Linear["Linear Scanning"]
        direction TB
        L16["16 presses"]
        L64["64 presses"]
        L100["100 presses"]
    end

    subgraph RowCol["Row-Column Scanning"]
        direction TB
        R16["8 presses"]
        R64["16 presses"]
        R100["20 presses"]
    end

    subgraph Elim["Elimination (4-switch)"]
        direction TB
        E16["2-3 presses"]
        E64["3-4 presses"]
        E100["4-5 presses"]
    end

    N16 -.->|Linear| L16
    N16 -.->|Row-Col| R16
    N16 -.->|Elim| E16

    N64 -.->|Linear| L64
    N64 -.->|Row-Col| R64
    N64 -.->|Elim| E64

    N100 -.->|Linear| L100
    N100 -.->|Row-Col| R100
    N100 -.->|Elim| E100

    classDef linearStyle fill:#ffebee,stroke:#333,stroke-width:2px
    classDef rowColStyle fill:#fff3e0,stroke:#333,stroke-width:2px
    classDef elimStyle fill:#e8f5e9,stroke:#333,stroke-width:2px
    classDef gridSizeStyle fill:#f3f4f6,stroke:#333,stroke-width:2px

    class L16,L64,L100 linearStyle
    class R16,R64,R100 rowColStyle
    class E16,E64,E100 elimStyle
    class N16,N64,N100 gridSizeStyle
        </pre>

        <p><strong>Key Insight:</strong> As grid size grows, Elimination scanning's advantage becomes dramatic!</p>
    </section>

    <!-- Chapter 11 -->
    <section id="chapter-11">
        <h2>Chapter 11: Efficiency Calculator</h2>

        <p>Want to know exactly how many switch presses it takes to select an item? Let's calculate!</p>

        <h3>Interactive Efficiency Calculator</h3>

        <p>See how different patterns, layouts, and techniques affect typing speed in real-time!</p>

        <div class="demo-box">
            <div class="demo-title">âš¡ Advanced Efficiency Calculator</div>

            <!-- Configuration Controls -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">Alphabet Layout:</label>
                        <select id="alphabetLayout" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="alphabetical">A B C D E F...</option>
                            <option value="frequency" selected>E T A O I N...</option>
                        </select>
                    </div>

                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">Grid Size:</label>
                        <select id="calcGridSize" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="26">26 letters (full alphabet)</option>
                            <option value="36" selected>36 items (6Ã—6)</option>
                            <option value="64">64 items (8Ã—8)</option>
                            <option value="100">100 items (10Ã—10)</option>
                        </select>
                    </div>

                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">Scan Pattern:</label>
                        <select id="calcPattern" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="linear">Linear</option>
                            <option value="row-column" selected>Row-Column</option>
                            <option value="elimination">Elimination (4-switch)</option>
                        </select>
                    </div>

                    <div>
                        <label style="font-weight: bold; display: block; margin-bottom: 5px;">View Mode:</label>
                        <select id="calcViewMode" onchange="updateCalculator()" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="standard">Standard View</option>
                            <option value="cost-numbers" selected>Cost Numbers</option>
                            <option value="cost-heatmap">Cost Heatmap</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Sentence Typing Area -->
            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="margin-top: 0;">ğŸ’¬ Type a Sentence to See Costs:</h4>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="sentenceInput" placeholder="Type a sentence..." value="HELLO WORLD"
                           oninput="calculateSentenceCost()"
                           style="flex: 1; padding: 10px; font-size: 1.1em; border: 2px solid #3498db; border-radius: 4px;">
                    <button onclick="calculateSentenceCost()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                        Calculate
                    </button>
                </div>

                <div id="sentenceResult" style="padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #3498db;">
                    <em>Type a sentence and click "Calculate" to see the total cost breakdown!</em>
                </div>
            </div>

            <!-- Scanner Visualization -->
            <div style="background: white; padding: 20px; border-radius: 8px;">
                <h4 style="margin-top: 0;">ğŸ¯ Real-Time Scanner Preview:</h4>
                <div class="scanner-container large" style="min-height: 400px;">
                    <switch-scanner
                        id="calcScanner"
                        grid-content="keyboard"
                        language="en"
                        layout-mode="alphabetical"
                        grid-size="36"
                        scan-pattern="row-column"
                        scan-rate="500"
                        view-mode="cost-numbers">
                    </switch-scanner>
                </div>
            </div>
        </div>

        <h3>Real-World Example: Typing "THE"</h3>

        <p>Let's compare how long it takes to type common words using different alphabet layouts.</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: #ffeaa7; padding: 20px; border-radius: 8px;">
                <h4>ğŸ“ Alphabetical Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em;">A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</p>

                <div class="calculator-result">
                    <p><strong>Cost breakdown:</strong></p>
                    <ul>
                        <li>T = 20th position â†’ <strong>5 row + 20 presses</strong></li>
                        <li>H = 8th position â†’ <strong>3 row + 8 presses</strong></li>
                        <li>E = 5th position â†’ <strong>2 row + 5 presses</strong></li>
                    </ul>
                    <p><strong>Total: 43 presses</strong></p>
                    <p><em>At 1000ms scan rate: 43 seconds</em></p>
                </div>
            </div>

            <div style="background: #d5f4e6; padding: 20px; border-radius: 8px;">
                <h4>âš¡ Frequency Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em;">E T A O I N S H R D L C U M W F G Y P B V K J X Q Z</p>

                <div class="calculator-result">
                    <p><strong>Cost breakdown:</strong></p>
                    <ul>
                        <li>T = 2nd position â†’ <strong>1 row + 2 presses</strong></li>
                        <li>H = 9th position â†’ <strong>3 row + 9 presses</strong></li>
                        <li>E = 1st position â†’ <strong>1 row + 1 presses</strong></li>
                    </ul>
                    <p><strong>Total: 17 presses</strong></p>
                    <p><em>At 1000ms scan rate: 17 seconds</em></p>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <strong>ğŸ¯ Result:</strong> Frequency layout is <strong>60% faster</strong> for typing "THE"!<br>
            Alphabetical: 43 presses (43 seconds)<br>
            Frequency: 17 presses (17 seconds)<br>
            <strong>Time saved: 26 seconds per 3-letter word!</strong>
        </div>

        <h3>âš¡ Quick Examples - Try These Sentences!</h3>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
            <button onclick="trySentence('HELLO WORLD')" style="padding: 15px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ‘‹ HELLO WORLD
            </button>
            <button onclick="trySentence('I NEED HELP')" style="padding: 15px; background: #9b59b6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ†˜ I NEED HELP
            </button>
            <button onclick="trySentence('THANK YOU')" style="padding: 15px; background: #2ecc71; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ™ THANK YOU
            </button>
            <button onclick="trySentence('MY NAME IS')" style="padding: 15px; background: #e74c3c; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ‘¤ MY NAME IS
            </button>
            <button onclick="trySentence('YES NO')" style="padding: 15px; background: #f39c12; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                âœ… YES NO
            </button>
            <button onclick="trySentence('I AM HUNGRY')" style="padding: 15px; background: #1abc9c; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                ğŸ I AM HUNGRY
            </button>
        </div>

        <h3>ğŸ“Š Compare: Alphabetical vs Frequency Layout</h3>

        <p>See the dramatic difference between alphabetical and frequency-based layouts!</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div style="background: #ffeaa7; padding: 20px; border-radius: 8px;">
                <h4>ğŸ“ Alphabetical Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em; word-break: break-all;">A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</p>

                <div class="calculator-result">
                    <p><strong>Typing "THE":</strong></p>
                    <ul>
                        <li>T = 20th â†’ <strong>5 + 20 = 25 presses</strong></li>
                        <li>H = 8th â†’ <strong>2 + 8 = 10 presses</strong></li>
                        <li>E = 5th â†’ <strong>2 + 5 = 7 presses</strong></li>
                    </ul>
                    <p><strong>Total: 42 presses (42 seconds)</strong></p>
                </div>
            </div>

            <div style="background: #d5f4e6; padding: 20px; border-radius: 8px;">
                <h4>âš¡ Frequency Layout</h4>
                <p style="font-family: monospace; font-size: 1.2em; word-break: break-all;">E T A O I N S H R D L C U M W F G Y P B V K J X Q Z</p>

                <div class="calculator-result">
                    <p><strong>Typing "THE":</strong></p>
                    <ul>
                        <li>T = 2nd â†’ <strong>1 + 2 = 3 presses</strong></li>
                        <li>H = 9th â†’ <strong>3 + 9 = 12 presses</strong></li>
                        <li>E = 1st â†’ <strong>1 + 1 = 2 presses</strong></li>
                    </ul>
                    <p><strong>Total: 17 presses (17 seconds)</strong></p>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <strong>ğŸ¯ Result:</strong> Frequency layout is <strong>60% faster</strong> for "THE"!<br>
            Alphabetical: 42 presses | Frequency: 17 presses | <strong>Saved: 25 presses (25 seconds)!</strong>
        </div>

        <h3>Comparison Table: Common Words</h3>

        <table class="comparison-table">
            <tr>
                <th>Word</th>
                <th>Alphabetical<br/>(Row-Column)</th>
                <th>Frequency<br/>(Row-Column)</th>
                <th>Improvement</th>
            </tr>
            <tr>
                <td>THE</td>
                <td>42 presses (42s)</td>
                <td>17 presses (17s)</td>
                <td><strong>60% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>AND</td>
                <td>30 presses (30s)</td>
                <td>13 presses (13s)</td>
                <td><strong>57% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>YOU</td>
                <td>48 presses (48s)</td>
                <td>19 presses (19s)</td>
                <td><strong>60% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>THAT</td>
                <td>47 presses (47s)</td>
                <td>23 presses (23s)</td>
                <td><strong>51% faster âœ…</strong></td>
            </tr>
            <tr>
                <td>HELLO</td>
                <td>60 presses (60s)</td>
                <td>30 presses (30s)</td>
                <td><strong>50% faster âœ…</strong></td>
            </tr>
        </table>

        <p style="text-align: center; margin: 20px 0;">
            <em>* Using Row-Column scanning at 1000ms rate | Try different patterns in the calculator above!</em>
        </p>

        <div class="info-box">
            <strong>ğŸ’¡ Key Insight:</strong> Over a day of typing, frequency-based layouts can save <strong>THOUSANDS of switch presses</strong>!<br>
            This dramatically reduces fatigue and increases communication speed.<br><br>
            <strong>ğŸ¯ Try it:</strong> Use the calculator above to type your own sentences and see real costs with different patterns!
        </div>
    </section>

    <!-- Chapter 12 -->
    <section id="chapter-12">
        <h2>Chapter 12: Timing & Optimization</h2>

        <p>Finding the right scan rate is crucial. Too fast = errors. Too slow = frustration.</p>

        <h3>Interactive Rate Comparison</h3>

        <div class="demo-instructions">
            ğŸ® <strong>Try all three speeds</strong> - Which feels most comfortable?<br>
            Notice how your ability to keep up changes!
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
            <div>
                <h4>ğŸ¢ Slow (2000ms)</h4>
                <p>Best for: Beginners, users with slow reaction time</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="2000"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Easy to keep up, low stress<br><strong>Cons:</strong> Takes a long time</p>
            </div>

            <div>
                <h4>ğŸš¶ Medium (1000ms)</h4>
                <p>Best for: Most intermediate users</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1000"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Good balance<br><strong>Cons:</strong> Some users may feel rushed</p>
            </div>

            <div>
                <h4>ğŸ‡ Fast (500ms)</h4>
                <p>Best for: Advanced users with fast reaction time</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="500"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Very fast selections<br><strong>Cons:</strong> High error rate for most users</p>
            </div>
        </div>

        <h3>Timing Guidelines by User Profile</h3>

        <table class="comparison-table">
            <tr>
                <th>User Profile</th>
                <th>Recommended Rate</th>
                <th>Reason</th>
            </tr>
            <tr>
                <td>Beginner</td>
                <td>1500-2000ms</td>
                <td>Learning curve, building confidence</td>
            </tr>
            <tr>
                <td>Intermediate</td>
                <td>1000-1500ms</td>
                <td>Balance of speed and accuracy</td>
            </tr>
            <tr>
                <td>Advanced</td>
                <td>500-1000ms</td>
                <td>Maximum efficiency</td>
            </tr>
            <tr>
                <td>Motor impairment (tremors)</td>
                <td>1500ms + 500ms acceptance time</td>
                <td>Filter out tremors, allow reaction</td>
            </tr>
            <tr>
                <td>Visual impairment</td>
                <td>1000-1500ms + audio</td>
                <td>Need time for audio feedback</td>
            </tr>
            <tr>
                <td>Cognitive impairment</td>
                <td>1500-2000ms</td>
                <td>More thinking time needed</td>
            </tr>
            <tr>
                <td>Fatigue (MND/ALS progression)</td>
                <td>Morning: 1000ms, Afternoon: 1500ms</td>
                <td>Accommodate energy changes</td>
            </tr>
        </table>

        <h3>Dwell Selection Demo</h3>

        <p>Dwell time allows selection without pressing a switch - just wait on the item!</p>

        <div class="demo-instructions">
            ğŸ® <strong>Try it:</strong> Just wait on an item for 2 seconds - it will auto-select!<br>
            No switch press needed. Great for users who can't reliably press switches.
        </div>

        <div class="scanner-container small">
            <switch-scanner
                theme="sketch"
                scan-pattern="linear"
                dwell-time="2000"
                scan-rate="1500"
                grid-size="9">
            </switch-scanner>
        </div>

        <div class="highlight-box">
            <strong>ğŸ’¡ When to use dwell selection:</strong><br>
            â€¢ User has consistent movement but unreliable switch activation<br>
            â€¢ Reducing physical fatigue<br>
            â€¢ Head tracking or eye tracking systems<br>
            â€¢ "Hands-free" scanning requirement
        </div>

        <h3>Scan Loops Demo</h3>

        <p>Should scanning continue forever, or stop after a few cycles?</p>

        <div class="demo-instructions">
            ğŸ® <strong>Compare:</strong> Watch how infinite scanning keeps going, while 2-loop scanning stops and waits.<br>
            Notice which feels less anxiety-producing!
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>â™¾ï¸ Infinite Loops (0)</h4>
                <p>Scanning never stops - can feel endless</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1000"
                        scan-loops="0"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Infinite chances<br><strong>Cons:</strong> Can feel endless, anxiety</p>
            </div>

            <div>
                <h4>ğŸ”„ Two Loops (2)</h4>
                <p>Scans twice, then stops and waits</p>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1000"
                        scan-loops="2"
                        grid-size="9">
                    </switch-scanner>
                </div>
                <p><strong>Pros:</strong> Predictable, less anxiety<br><strong>Cons:</strong> Might miss item if distracted</p>
            </div>
        </div>

        <div class="info-box">
            <strong>ğŸ“Š Success Probability:</strong><br>
            With 2 loops and 90% success rate: 1 - (0.10Â²) = 99% success probability!<br>
            With 4 loops and 90% success rate: 1 - (0.10â´) = 99.99% success probability!
        </div>
    </section>

    <!-- Chapter 13 -->
    <section id="chapter-13">
        <h2>Chapter 13: Visualization Options</h2>

        <p>How the highlight looks matters! Let's explore different visualization options.</p>

        <h3>Interactive: Border Width Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Compare the three options below - which is most visible to you?
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div>
                <h4>Thin (2px)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-border-width="2">
                    </switch-scanner>
                </div>
                <p>Subtle, may be hard to see</p>
            </div>

            <div>
                <h4>Medium (4px) - Default</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-border-width="4">
                    </switch-scanner>
                </div>
                <p>Good balance of visibility</p>
            </div>

            <div>
                <h4>Thick (8px)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-border-width="8">
                    </switch-scanner>
                </div>
                <p>Very visible, great for low vision</p>
            </div>
        </div>

        <h3>Interactive: Scale (Zoom) Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Notice how the highlighted items grow larger with higher scale values!
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>No Zoom (Scale 1.0)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-scale="1.0">
                    </switch-scanner>
                </div>
            </div>

            <div>
                <h4>20% Zoom (Scale 1.2)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-scale="1.2">
                    </switch-scanner>
                </div>
                <p>Makes items easier to see!</p>
            </div>
        </div>

        <h3>Interactive: Animation Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Compare static vs animated highlighting - which draws your attention better?
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>Static (No Animation)</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-animation="false">
                    </switch-scanner>
                </div>
                <p>Simple, clear, less distraction</p>
            </div>

            <div>
                <h4>Pulse Animation</h4>
                <div class="scanner-container small">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="linear"
                        scan-rate="1500"
                        grid-size="9"
                        highlight-animation="true">
                    </switch-scanner>
                </div>
                <p>Draws attention, good for low vision</p>
            </div>
        </div>

        <h3>Visualization Recommendations</h3>

        <table class="comparison-table">
            <tr>
                <th>User Need</th>
                <th>Recommended Settings</th>
            </tr>
            <tr>
                <td>Low Vision</td>
                <td>Thick borders (6-8px), Scale 1.2-1.3, Animation ON, High contrast colors</td>
            </tr>
            <tr>
                <td>Cognitive Impairment</td>
                <td>Medium borders (4px), Scale 1.0-1.1, Animation OFF (distracting)</td>
            </tr>
            <tr>
                <td>Beginner</td>
                <td>Thick borders (6px), Scale 1.2, Animation ON (helps tracking)</td>
            </tr>
            <tr>
                <td>Advanced/Power User</td>
                <td>Thin borders (2-4px), Scale 1.0, Animation OFF (minimal distraction)</td>
            </tr>
            <tr>
                <td>Distractible</td>
                <td>Thick borders, Scale 1.1, Animation OFF, Low opacity on non-highlighted</td>
            </tr>
        </table>
    </section>

    <!-- Chapter 14 -->
    <section id="chapter-14">
        <h2>Chapter 14: Block vs Point Technique</h2>

        <p>When using row-column scanning, how should groups be highlighted?</p>

        <h3>Interactive Comparison</h3>

        <div class="demo-instructions">
            ğŸ® Watch how the two techniques highlight rows differently!<br>
            Which is easier for you to follow?
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>Block Technique</h4>
                <p>Entire row lights up as solid block</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="block"
                        scan-rate="1500"
                        grid-size="16">
                    </switch-scanner>
                </div>
                <div class="highlight-box">
                    <strong>âœ… Pros:</strong>
                    <ul>
                        <li>Easy to see</li>
                        <li>Clear group boundaries</li>
                        <li>Less visual searching</li>
                        <li>Better for beginners</li>
                    </ul>
                </div>
                <div class="warning-box">
                    <strong>âŒ Cons:</strong>
                    <ul>
                        <li>Can overwhelm visually</li>
                        <li>Harder to see individual items</li>
                        <li>More visual "noise"</li>
                    </ul>
                </div>
            </div>

            <div>
                <h4>Point Technique</h4>
                <p>Only row indicator highlights</p>
                <div class="scanner-container">
                    <switch-scanner
                        theme="sketch"
                        scan-pattern="row-column"
                        scan-technique="point"
                        scan-rate="1500"
                        grid-size="16">
                    </switch-scanner>
                </div>
                <div class="highlight-box">
                    <strong>âœ… Pros:</strong>
                    <ul>
                        <li>Less visual clutter</li>
                        <li>Easier to focus</li>
                        <li>Better for dense grids</li>
                        <li>Preferred by experienced users</li>
                    </ul>
                </div>
                <div class="warning-box">
                    <strong>âŒ Cons:</strong>
                    <ul>
                        <li>Harder to see boundaries</li>
                        <li>Less intuitive</li>
                        <li>Requires abstract thinking</li>
                        <li>Can be confusing at first</li>
                    </ul>
                </div>
            </div>
        </div>

        <h3>Decision Tree: Which Technique?</h3>

        <div class="diagram">
            <pre style="background: white; color: #333;">
Does user have low vision?
â”œâ”€ Yes â†’ Use BLOCK technique
â””â”€ No
   â”œâ”€ Are items large icons/images?
   â”‚  â”œâ”€ Yes â†’ Use BLOCK technique
   â”‚  â””â”€ No
   â”‚     â”œâ”€ Is grid dense (>64 items)?
   â”‚     â”‚  â”œâ”€ Yes â†’ Use POINT technique
   â”‚     â””â”€ No â†’ User preference
   â””â”€ Is user a beginner?
      â”œâ”€ Yes â†’ Start with BLOCK
      â””â”€ No â†’ User preference
            </pre>
        </div>

        <h3>Real-World Recommendation</h3>

        <div class="info-box">
            <strong>ğŸ’¡ Best Practice:</strong> Start with BLOCK technique for all beginners.<br>
            Once user is comfortable (after 2-4 weeks), try POINT technique and see what they prefer.<br><br>
            Many users eventually prefer POINT for faster scanning, but BLOCK is essential for learning!
        </div>
    </section>

    <!-- Feedback Element -->
    <div id="feedback"></div>

    <script type="module" src="/src/main.ts"></script>
    <script>
        // Force scrollbar visibility and proper scrolling
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure document is scrollable
            const ensureScrollable = () => {
                const docHeight = document.documentElement.scrollHeight;
                const winHeight = window.innerHeight;

                if (docHeight > winHeight) {
                    document.documentElement.style.overflowY = 'auto';
                    document.body.style.overflowY = 'auto';
                }

                console.log('Document height:', docHeight, 'Window height:', winHeight);
            };

            // Check on load
            ensureScrollable();

            // Check after a short delay (for web components to render)
            setTimeout(ensureScrollable, 500);

            // Check again after images/components load
            window.addEventListener('load', ensureScrollable);
        });

        // Enhanced feedback with sound simulation
        // Enhanced feedback with sound simulation
        document.body.addEventListener('scanner:selection', (e) => {
            const item = e.detail.item;
            const feedback = document.getElementById('feedback');

            feedback.textContent = `âœ“ Selected: ${item.label}`;
            feedback.classList.add('show');

            setTimeout(() => {
                feedback.classList.remove('show');
            }, 2000);
        });

        // Smooth scroll for navigation
        document.querySelectorAll('.toc a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Efficiency Calculator - Enhanced
        const ALPHABETICAL = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const FREQUENCY = 'ETAOINSHRDLCUMWFGYPBVKJXQZ';

        function getAlphabet(layout) {
            return layout === 'frequency' ? FREQUENCY : ALPHABETICAL;
        }

        function getLetterCost(letter, gridSize, pattern, layout) {
            const alphabet = getAlphabet(layout);
            const position = alphabet.indexOf(letter.toUpperCase()) + 1;

            if (position === -1) return 0; // Space or unknown character

            const sqrt = Math.sqrt(gridSize);
            const rows = Math.ceil(sqrt);
            const cols = Math.ceil(gridSize / rows);

            switch (pattern) {
                case 'linear':
                    return position;

                case 'row-column':
                    const targetRow = Math.ceil(position / cols);
                    const targetCol = ((position - 1) % cols) + 1;
                    return targetRow + targetCol;

                case 'elimination':
                    return Math.ceil(Math.log(gridSize) / Math.log(4));

                default:
                    return position;
            }
        }

        function calculateSentenceCost() {
            const sentence = document.getElementById('sentenceInput').value.toUpperCase();
            const gridSize = parseInt(document.getElementById('calcGridSize').value);
            const pattern = document.getElementById('calcPattern').value;
            const layout = document.getElementById('alphabetLayout').value;

            let totalCost = 0;
            let letterCosts = [];

            for (let letter of sentence) {
                const cost = getLetterCost(letter, gridSize, pattern, layout);
                totalCost += cost;
                letterCosts.push({ letter, cost });
            }

            // Display results
            const avgCost = totalCost / sentence.length;
            const totalTime = (totalCost * 1.0).toFixed(1); // At 1000ms scan rate

            let letterBreakdown = letterCosts.map(lc => {
                const bgColor = lc.cost > 10 ? '#ffcdd2' : lc.cost > 6 ? '#ffe0b2' : '#c8e6c9';
                return `<span style="display: inline-block; padding: 2px 6px; margin: 2px; background: ${bgColor}; border-radius: 4px; font-weight: bold;">
                    ${lc.letter === ' ' ? 'â£' : lc.letter}<span style="font-size: 0.8em; color: #666;">(${lc.cost})</span>
                </span>`;
            }).join('');

            const resultHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="margin-top: 0;">ğŸ“Š Cost Breakdown</h4>
                        <p><strong>Total Switch Presses:</strong> ${totalCost}</p>
                        <p><strong>Average per Letter:</strong> ${avgCost.toFixed(1)} presses</p>
                        <p><strong>Time (at 1000ms):</strong> ${totalTime} seconds</p>
                        <p><strong>Letters:</strong> ${sentence.length}</p>
                    </div>
                    <div>
                        <h4 style="margin-top: 0;">ğŸ¨ Color Legend</h4>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="padding: 4px 8px; background: #c8e6c9; border-radius: 4px;">Low cost (1-6)</span>
                            <span style="padding: 4px 8px; background: #ffe0b2; border-radius: 4px;">Medium cost (7-10)</span>
                            <span style="padding: 4px 8px; background: #ffcdd2; border-radius: 4px;">High cost (11+)</span>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4>ğŸ”¤ Letter-by-Letter Breakdown:</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px; line-height: 2;">
                        ${letterBreakdown}
                    </div>
                </div>

                <div class="highlight-box" style="margin-top: 15px; background: #e8f5e9; border-left-color: #4CAF50;">
                    <strong>ğŸ’¡ Tip:</strong> Switch to <em>Frequency</em> layout and <em>Elimination</em> pattern for best results!
                    Try the same sentence with different settings to compare.
                </div>
            `;

            document.getElementById('sentenceResult').innerHTML = resultHTML;
        }

        function updateCalculator() {
            const layout = document.getElementById('alphabetLayout').value;
            const gridSize = document.getElementById('calcGridSize').value;
            const pattern = document.getElementById('calcPattern').value;
            const viewMode = document.getElementById('calcViewMode').value;

            // Update the scanner
            const scanner = document.getElementById('calcScanner');
            if (scanner) {
                scanner.setAttribute('grid-size', gridSize);
                scanner.setAttribute('scan-pattern', pattern);
                scanner.setAttribute('layout-mode', layout);
                scanner.setAttribute('view-mode', viewMode);
            }

            // Recalculate sentence if there's input
            const sentenceInput = document.getElementById('sentenceInput');
            if (sentenceInput && sentenceInput.value) {
                calculateSentenceCost();
            }
        }

        // Old calculator (kept for backward compatibility)
        window.calculateEfficiency = calculateSentenceCost;

        // Quick sentence examples
        function trySentence(sentence) {
            document.getElementById('sentenceInput').value = sentence;
            calculateSentenceCost();

            // Scroll to result
            document.getElementById('sentenceResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Add navigation buttons to each section
        const chapters = document.querySelectorAll('section');
        const chapterTitles = [
            'What is a Switch?',
            'The Bandwidth Problem',
            'Cause & Effect',
            'Selection Sets',
            'Single Switch Scanning',
            'Two Switch Scanning',
            'Why Group?',
            'Row-Column Scanning',
            'Elimination Scanning',
            'Pattern Comparison',
            'Efficiency Calculator',
            'Timing & Optimization',
            'Visualization Options',
            'Block vs Point'
        ];

        chapters.forEach((chapter, index) => {
            const nav = document.createElement('div');
            nav.className = 'chapter-nav';

            // Previous button
            if (index > 0) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'prev-btn';
                prevBtn.innerHTML = 'â† ' + chapterTitles[index - 1];
                prevBtn.onclick = () => {
                    chapters[index - 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                };
                nav.appendChild(prevBtn);
            } else {
                const spacer = document.createElement('div');
                nav.appendChild(spacer);
            }

            // Next button
            if (index < chapters.length - 1) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'next-btn';
                nextBtn.innerHTML = chapterTitles[index + 1] + ' â†’';
                nextBtn.onclick = () => {
                    chapters[index + 1].scrollIntoView({ behavior: 'smooth', block: 'start' });
                };
                nav.appendChild(nextBtn);
            }

            chapter.appendChild(nav);
        });

        // Progress bar
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progressBar').style.width = scrolled + '%';
        });

        // Back to top button
        const backToTop = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>

    <!-- Initialize Mermaid with Sketch Theme -->
    <script>
        // Configure mermaid with sketch-friendly settings
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#fff',
                primaryTextColor: '#333',
                primaryBorderColor: '#333',
                lineColor: '#333',
                secondaryColor: '#f0f0f0',
                tertiaryColor: '#fffdf9',
                fontFamily: 'Patrick Hand',
                fontSize: '16px'
            },
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis' // Curved lines look more hand-drawn
            }
        });
    </script>
</body>
</html>
